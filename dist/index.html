<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UI Workbench — Bondwood</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
<style>
  *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
  :root {
    --bg: #0f1210; --surface: #1a1f1c; --surface-hover: #232a26;
    --text: #e8e8e8; --text-mid: #aaa; --text-dim: #666; --text-faint: #555;
    --border: rgba(255,255,255,0.08); --input-bg: #1a1f1c;
    --input-border: rgba(255,255,255,0.1);
    --accent: #4a7aff; --accent-dim: rgba(74,122,255,0.15);
    --card-body-title: #e8e8e8; --card-body-strong: #e0e0e0;
    --topbar-bg: rgba(15,18,16,0.92); --topbar-border: rgba(255,255,255,0.06);
    --footer-border: rgba(255,255,255,0.06);
    --shadow: 0 2px 12px rgba(0,0,0,0.3); --star-shadow: 0 0 20px rgba(244,180,0,0.15);
  }
  [data-theme="light"] {
    --bg: #f4f5f3; --surface: #ffffff; --surface-hover: #f0f0ee;
    --text: #1a1a1a; --text-mid: #555; --text-dim: #888; --text-faint: #aaa;
    --border: rgba(0,0,0,0.08); --input-bg: #ffffff;
    --input-border: rgba(0,0,0,0.12);
    --accent: #0728eb; --accent-dim: rgba(7,40,235,0.08);
    --card-body-title: #1a1a1a; --card-body-strong: #1a1a1a;
    --topbar-bg: rgba(244,245,243,0.92); --topbar-border: rgba(0,0,0,0.06);
    --footer-border: rgba(0,0,0,0.06);
    --shadow: 0 2px 12px rgba(0,0,0,0.08); --star-shadow: 0 0 20px rgba(244,180,0,0.2);
  }
  body { min-height:100vh; background:var(--bg); color:var(--text); font-family:'Inter',system-ui,sans-serif; -webkit-font-smoothing:antialiased; transition:background 0.25s,color 0.25s; }

  /* ── TOP BAR ── */
  .top-bar { position:sticky; top:0; z-index:100; background:var(--topbar-bg); backdrop-filter:blur(16px); border-bottom:1px solid var(--topbar-border); padding:16px 24px; transition:background 0.25s,border-color 0.25s; }
  .top-bar-inner { max-width:1600px; margin:0 auto; display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:12px; }
  .top-bar h1 { font-size:18px; font-weight:700; letter-spacing:-0.3px; }
  .top-bar .sub { font-size:11px; color:var(--text-dim); margin-top:2px; }
  .top-bar-actions { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
  .card-count { font-size:11px; color:var(--text-faint); }
  .theme-toggle-wrap { display:flex; align-items:center; gap:6px; margin-left:4px; }
  .theme-toggle-label { font-size:10px; color:var(--text-dim); user-select:none; }
  .theme-toggle { width:36px; height:20px; border-radius:10px; background:var(--surface-hover); border:1px solid var(--input-border); cursor:pointer; position:relative; transition:all 0.25s; flex-shrink:0; }
  .theme-toggle::after { content:''; position:absolute; top:2px; left:2px; width:14px; height:14px; border-radius:50%; background:var(--text-dim); transition:all 0.25s; }
  [data-theme="light"] .theme-toggle::after { left:18px; background:#f4b400; }
  .btn-fav-filter { background:rgba(244,180,0,0.12); color:#f4b400; border:none; border-radius:6px; padding:6px 14px; font-size:11px; font-weight:600; cursor:pointer; transition:all 0.15s; }
  .btn-fav-filter.active { background:#f4b400; color:#1a1a1a; }
  .btn-fav-filter:hover { filter:brightness(1.15); }
  .btn-clear { background:rgba(255,80,80,0.1); color:#e07060; border:none; border-radius:6px; padding:6px 12px; font-size:11px; font-weight:500; cursor:pointer; }
  .btn-clear:hover { background:rgba(255,80,80,0.2); }
  .btn-save { background:rgba(74,122,255,0.12); color:var(--accent); border:none; border-radius:6px; padding:6px 14px; font-size:11px; font-weight:600; cursor:pointer; transition:all 0.15s; }
  .btn-save:hover { filter:brightness(1.15); }
  .btn-save.has-save { background:var(--accent); color:#fff; }
  .btn-random { background:rgba(168,85,247,0.12); color:#a855f7; border:none; border-radius:6px; padding:6px 14px; font-size:11px; font-weight:600; cursor:pointer; transition:all 0.15s; }
  .btn-random:hover { background:rgba(168,85,247,0.25); }
  .save-indicator { font-size:10px; color:var(--text-faint); transition:all 0.3s; }
  .save-indicator.flash { color:#2B6D51; font-weight:600; }

  /* ── CONTROLS ── */
  .controls-wrap { max-width:1600px; margin:0 auto; padding:20px 24px 0; }
  .controls { background:var(--surface); border:1px solid var(--border); border-radius:12px; padding:20px 24px; display:flex; gap:14px; align-items:flex-end; flex-wrap:wrap; transition:background 0.25s,border-color 0.25s; }
  .control-group { flex:1 1 180px; }
  .control-group.wide { flex:1 1 240px; }
  .control-group label { display:block; font-size:9px; font-weight:700; letter-spacing:2px; text-transform:uppercase; color:var(--accent); margin-bottom:6px; }
  .custom-select { position:relative; width:100%; }
  .custom-select-trigger { width:100%; padding:10px 36px 10px 14px; background:var(--input-bg); border:1px solid var(--input-border); border-radius:8px; color:var(--text); font-size:13px; font-family:'Inter',sans-serif; cursor:pointer; outline:none; transition:all 0.25s; position:relative; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; user-select:none; }
  .custom-select-trigger::after { content:'▾'; position:absolute; right:12px; top:50%; transform:translateY(-50%); font-size:12px; color:var(--text-dim); pointer-events:none; }
  .custom-select-trigger:hover { border-color:var(--accent); }
  .custom-select.open .custom-select-trigger { border-color:var(--accent); border-radius:8px 8px 0 0; }
  .custom-select-dropdown { display:none; position:absolute; top:100%; left:0; right:0; background:var(--input-bg); border:1px solid var(--accent); border-top:none; border-radius:0 0 8px 8px; max-height:280px; overflow-y:auto; z-index:50; box-shadow:0 8px 24px rgba(0,0,0,0.3); }
  .custom-select.open .custom-select-dropdown { display:block; }
  .custom-select-search { width:100%; padding:8px 12px; background:transparent; border:none; border-bottom:1px solid var(--border); color:var(--text); font-size:12px; font-family:'Inter',sans-serif; outline:none; }
  .custom-select-search::placeholder { color:var(--text-faint); }
  .custom-select-option { padding:8px 14px; cursor:pointer; font-size:13px; color:var(--text-dim); transition:all 0.1s; display:flex; align-items:center; gap:10px; }
  .custom-select-option:hover { background:var(--accent-dim); color:var(--text); }
  .custom-select-option.selected { color:var(--accent); font-weight:600; }
  .custom-select-option .font-preview { font-size:15px; color:var(--text); flex-shrink:0; width:50px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
  .custom-select-option .font-name, .custom-select-option .opt-label { font-family:'Inter',sans-serif; font-size:11px; color:var(--text-dim); }
  .custom-select-option .opt-sub { font-size:10px; color:var(--text-faint); margin-left:4px; }
  .custom-select-option .brand-swatch { width:14px; height:14px; border-radius:3px; flex-shrink:0; border:1px solid rgba(128,128,128,0.3); }
  .custom-select-option.hidden { display:none; }
  .btn-add { background:var(--accent); color:#fff; border:none; border-radius:8px; padding:10px 28px; font-size:13px; font-weight:600; cursor:pointer; transition:all 0.15s; white-space:nowrap; flex-shrink:0; }
  .btn-add:hover { filter:brightness(1.15); }
  /* ── GRID — wider cards ── */
  .grid-wrap { max-width:1600px; margin:0 auto; padding:24px 24px 60px; }
  .grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(480px,1fr)); gap:20px; }
  .empty-state { text-align:center; padding:80px 20px; color:var(--text-faint); font-size:14px; }

  /* ── CARD ── */
  .card { border-radius:12px; overflow:hidden; border:1px solid var(--border); background:var(--surface); transition:all 0.2s; position:relative; box-shadow:var(--shadow); cursor:grab; }
  .card:active { cursor:grabbing; }
  .card.dragging { opacity:0.4; transform:scale(0.97); }
  .card.drag-over { outline:2px dashed var(--accent); outline-offset:3px; }
  .card.drag-over-top { border-top:3px solid var(--accent); }
  .card.drag-over-bottom { border-bottom:3px solid var(--accent); }
  .card.starred { border:2px solid #f4b400; box-shadow:var(--star-shadow); }
  .card .drag-grip { position:absolute; top:50%; left:0; transform:translateY(-50%); width:12px; height:40px; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:2px; opacity:0; transition:opacity 0.2s; cursor:grab; z-index:5; padding-left:2px; }
  .card:hover .drag-grip { opacity:0.5; }
  .card .drag-grip span { display:block; width:3px; height:3px; border-radius:50%; background:var(--text-dim); }
  .card .fav-badge { display:none; position:absolute; top:8px; right:8px; z-index:10; background:#f4b400; color:#1a1a1a; font-size:9px; font-weight:700; padding:2px 8px; border-radius:4px; letter-spacing:1px; text-transform:uppercase; }
  .card.starred .fav-badge { display:block; }

  /* Card Banner */
  .card-banner { padding:14px 18px 0; position:relative; }
  .card-banner-inner { display:flex; align-items:center; gap:10px; padding-bottom:10px; }
  .card-banner-hamburger { cursor:pointer; flex-shrink:0; opacity:0.85; transition:opacity 0.15s; }
  .card-banner-hamburger:hover { opacity:1; }
  .card-banner-title { font-weight:700; font-size:15px; line-height:1.1; color:#fff; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .card-banner-accent { height:3px; margin:0 -18px; }

  /* Hamburger Slide-out Drawer (matches real app) */
  .card-ham-overlay { display:none; position:absolute; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.45); z-index:20; border-radius:12px; }
  .card-ham-overlay.open { display:block; }
  .card-ham-drawer {
    position:absolute; top:0; left:0; bottom:0; width:220px; z-index:21;
    border-radius:12px 0 0 12px; overflow-y:auto;
    transform:translateX(-100%); transition:transform 0.2s cubic-bezier(0.4,0,0.2,1);
    box-shadow:2px 0 12px rgba(0,0,0,0.4);
  }
  .card-ham-drawer.open { transform:translateX(0); }
  .card-ham-drawer-inner { padding:16px; }
  .card-ham-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }
  .card-ham-title { color:#fff; font-size:14px; font-weight:700; }
  .card-ham-close { background:none; border:none; color:rgba(255,255,255,0.7); cursor:pointer; padding:2px; line-height:1; }
  .card-ham-close:hover { color:#fff; }
  .card-ham-logo-wrap { text-align:center; padding:10px 0 14px; border-bottom:1px solid rgba(255,255,255,0.1); margin-bottom:14px; }
  .card-ham-logo-wrap img { max-height:52px; max-width:100%; width:auto; object-fit:contain; }
  .card-ham-section-label { color:rgba(255,255,255,0.45); font-size:8px; font-weight:700; text-transform:uppercase; letter-spacing:1px; margin-bottom:6px; }
  .card-ham-nav { display:flex; flex-direction:column; gap:3px; margin-bottom:14px; }
  .card-ham-nav-item { padding:6px 10px; border-radius:6px; font-size:10px; color:rgba(255,255,255,0.7); }
  .card-ham-nav-item.active { background:rgba(255,255,255,0.12); color:#fff; font-weight:600; }
  .card-ham-colors { display:flex; gap:8px; margin-top:8px; }
  .card-ham-swatch { width:22px; height:22px; border-radius:4px; border:1px solid rgba(255,255,255,0.2); }
  .card-ham-swatch-label { font-size:7px; color:rgba(255,255,255,0.4); text-align:center; margin-top:2px; }
  .card-ham-brand-name { color:#fff; font-size:11px; font-weight:700; margin-bottom:1px; }
  .card-ham-brand-num { font-size:9px; color:rgba(255,255,255,0.45); }

  /* Card App Body — more room */
  .card-app-body { padding:16px 18px 12px; min-height:280px; }
  .card-app-body .app-module-title { font-weight:700; font-size:15px; color:var(--card-body-title); margin-bottom:2px; letter-spacing:0.3px; }
  .card-app-body .app-subtitle { font-size:9.5px; color:var(--text-dim); margin-bottom:10px; }

  /* Section Headers (collapsible style like real app) */
  .mini-section-hdr { font-size:11px; font-weight:700; color:var(--card-body-title); margin:10px 0 6px; display:flex; align-items:center; gap:6px; }
  .mini-section-hdr::before { content:'▾'; font-size:9px; color:var(--text-dim); }

  /* Mini Stats Grid */
  .mini-stats { display:flex; border-top:3px solid var(--stat-accent,#000); border-radius:6px; overflow:hidden; border:1px solid var(--border); margin-bottom:10px; background:var(--surface); }
  .mini-stat { flex:1; padding:7px 10px; border-left:1px solid var(--border); min-width:0; }
  .mini-stat:first-child { border-left:none; }
  .mini-stat-label { font-size:7.5px; font-weight:700; text-transform:uppercase; letter-spacing:0.5px; color:var(--text-dim); margin-bottom:2px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .mini-stat-value { font-size:13px; font-weight:700; color:var(--card-body-title); letter-spacing:0.3px; }
  .mini-stat-sub { font-size:7px; color:var(--text-faint); margin-top:1px; }
  .mini-stat-value.warn { color:#d97706; } .mini-stat-value.danger { color:#FA050F; } .mini-stat-value.green { color:#2B6D51; }

  /* Mini Table */
  .mini-table { width:100%; border-collapse:collapse; font-size:8.5px; border:1px solid var(--border); border-radius:6px; overflow:hidden; }
  .mini-table thead th { padding:5px 7px; font-weight:700; text-transform:uppercase; letter-spacing:0.3px; font-size:7px; color:#fff; text-align:left; white-space:nowrap; }
  .mini-table tbody td { padding:4px 7px; border-top:1px solid var(--border); color:var(--text-mid); white-space:nowrap; }
  .mini-badge { display:inline-block; padding:1px 6px; border-radius:8px; font-size:7px; font-weight:700; text-transform:uppercase; }
  .mini-badge.active { background:rgba(43,109,81,0.12); color:#2B6D51; }
  .mini-badge.expiring { background:rgba(217,119,6,0.12); color:#d97706; }
  .mini-badge.expired { background:rgba(250,5,15,0.12); color:#FA050F; }
  .mini-badge.draft { background:rgba(107,114,128,0.12); color:#6b7280; }
  .mini-badge.pending { background:rgba(7,40,235,0.1); color:#0728eb; }
  .mini-badge.approved { background:rgba(22,163,74,0.12); color:#15803d; }

  /* Mini Filter Bar */
  .mini-filter-bar { display:flex; gap:4px; margin-bottom:8px; align-items:center; }
  .mini-search { flex:1; padding:3px 6px; border:1px solid var(--border); border-radius:4px; font-size:8px; background:var(--input-bg); color:var(--text-dim); font-family:inherit; }
  .mini-select { padding:3px 6px; border:1px solid var(--border); border-radius:4px; font-size:8px; background:var(--input-bg); color:var(--text-dim); font-family:inherit; }

  /* Mini Tabs */
  .mini-tabs { display:flex; gap:2px; margin-bottom:8px; }
  .mini-tab { padding:3px 8px; border-radius:4px; font-size:7.5px; font-weight:600; color:var(--text-dim); background:var(--surface-hover); border:1px solid var(--border); }
  .mini-tab.active { color:#fff; border-color:transparent; }

  /* Mini Donut Grid */
  .mini-donut-grid { display:grid; grid-template-columns:1fr 1fr; gap:8px; }
  .mini-bucket { border-radius:8px; overflow:hidden; border:1px solid var(--border); }
  .mini-bucket-header { padding:5px 8px; font-size:8.5px; font-weight:700; color:#fff; }
  .mini-bucket-body { padding:8px; display:flex; align-items:center; gap:8px; background:var(--surface); }
  .mini-bucket-body canvas { width:48px; height:48px; }
  .mini-bucket-stats { font-size:7.5px; color:var(--text-dim); line-height:1.5; }
  .mini-bucket-stats strong { color:var(--card-body-title); }

  /* Mini Chart */
  .mini-chart { height:65px; border-radius:6px; border:1px solid var(--border); background:var(--surface-hover); display:flex; align-items:flex-end; padding:4px; gap:2px; overflow:hidden; }
  .mini-chart-bar { flex:1; border-radius:2px 2px 0 0; min-width:4px; transition:height 0.3s; }

  /* Mini Form */
  .mini-form-row { display:flex; gap:6px; margin-bottom:6px; }
  .mini-form-field { flex:1; padding:4px 6px; border:1px solid var(--border); border-radius:4px; font-size:8px; color:var(--text-dim); background:var(--input-bg); }
  .mini-form-label { font-size:7px; font-weight:700; text-transform:uppercase; color:var(--text-dim); margin-bottom:2px; letter-spacing:0.3px; }
  .mini-btn { padding:3px 10px; border-radius:4px; font-size:7.5px; font-weight:600; border:none; color:#fff; cursor:default; }

  /* Heatmap */
  .mini-heatmap { display:grid; grid-template-columns:repeat(8,1fr); gap:2px; }
  .mini-hm-cell { height:12px; border-radius:2px; }

  /* ── BUTTERFLY CHART (Open Enrollment) ── */
  .butterfly-chart { width:100%; font-size:7.5px; }
  .butterfly-row { display:flex; align-items:center; gap:0; margin-bottom:2px; height:16px; }
  .butterfly-in-bar-wrap { width:80px; display:flex; justify-content:flex-end; }
  .butterfly-in-bar { height:12px; border-radius:2px 0 0 2px; min-width:1px; }
  .butterfly-in-val { width:22px; text-align:right; font-weight:600; padding-right:3px; font-variant-numeric:tabular-nums; }
  .butterfly-district { flex:1; text-align:center; padding:0 3px; border-radius:3px; color:#fff; font-weight:700; font-size:7px; line-height:16px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; min-width:0; }
  .butterfly-net { width:30px; text-align:right; font-weight:700; font-variant-numeric:tabular-nums; padding-right:3px; }
  .butterfly-out-val { width:22px; text-align:left; font-variant-numeric:tabular-nums; padding-left:3px; }
  .butterfly-out-bar-wrap { width:80px; }
  .butterfly-out-bar { height:12px; border-radius:0 2px 2px 0; min-width:1px; }
  .butterfly-header { display:flex; align-items:center; gap:0; margin-bottom:4px; font-size:7px; font-weight:700; color:var(--text-dim); text-transform:uppercase; letter-spacing:0.3px; }
  .butterfly-header > * { text-align:center; }

  /* ── COHORT DIAGONAL HEATMAP ── */
  .cohort-grid { width:100%; overflow-x:auto; }
  .cohort-grid table { border-collapse:collapse; width:100%; font-size:7px; font-variant-numeric:tabular-nums; }
  .cohort-grid th, .cohort-grid td { padding:2px 3px; text-align:center; white-space:nowrap; border:1px solid var(--border); min-width:28px; }
  .cohort-grid th { font-weight:700; font-size:6.5px; color:var(--text-dim); text-transform:uppercase; background:var(--surface-hover); position:sticky; top:0; }
  .cohort-grid .grade-label { text-align:right; font-weight:700; color:var(--text-dim); background:var(--surface-hover); position:sticky; left:0; min-width:20px; }
  .cohort-grid .cohort-cell { border-radius:3px; font-weight:700; color:#fff; }
  .cohort-grid .cohort-pct { font-size:5.5px; color:rgba(255,255,255,0.7); display:block; line-height:1; }
  .cohort-grid .summary-row td { font-weight:700; font-size:6.5px; background:var(--surface-hover); color:var(--card-body-title); }
  .cohort-grid .summary-row .row-label { font-size:6px; }

  /* ── SALARY COMPARISON BARS ── */
  .salary-lanes { display:flex; gap:2px; flex-wrap:wrap; margin-bottom:6px; }
  .salary-lane { padding:2px 5px; border-radius:3px; font-size:6.5px; font-weight:600; background:var(--surface-hover); border:1px solid var(--border); color:var(--text-dim); }
  .salary-lane.active { color:#fff; border-color:transparent; }
  .salary-info { padding:4px 8px; border-radius:4px; background:rgba(217,119,6,0.1); border:1px solid rgba(217,119,6,0.2); font-size:7px; color:#d97706; margin-bottom:8px; }
  .salary-headers { display:flex; justify-content:space-between; font-size:7px; color:var(--text-faint); margin-bottom:6px; padding:0 4px; }
  .salary-row { display:flex; align-items:center; gap:0; margin-bottom:5px; height:22px; }
  .salary-rank { width:14px; font-size:9px; font-weight:600; color:var(--text-dim); text-align:right; flex-shrink:0; }
  .salary-dot { width:8px; height:8px; border-radius:50%; margin:0 5px; flex-shrink:0; }
  .salary-name { width:100px; font-size:8.5px; font-weight:600; color:var(--card-body-title); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; flex-shrink:0; }
  .salary-entry-val { width:38px; font-size:7px; color:var(--text-dim); text-align:right; flex-shrink:0; padding-right:3px; font-variant-numeric:tabular-nums; }
  .salary-bar-wrap { flex:1; height:18px; position:relative; display:flex; align-items:center; min-width:0; }
  .salary-bar-entry { height:18px; border-radius:3px 0 0 3px; }
  .salary-bar-top { height:18px; border-radius:0 3px 3px 0; opacity:0.45; }
  .salary-median-label { position:absolute; left:0; right:0; text-align:center; font-size:8px; font-weight:700; color:#fff; text-shadow:0 1px 2px rgba(0,0,0,0.5); line-height:18px; pointer-events:none; }
  .salary-top-val { width:42px; font-size:7px; color:var(--text-dim); text-align:left; flex-shrink:0; padding-left:3px; font-variant-numeric:tabular-nums; }

  /* Card Footer */
  .card-footer { padding:10px 18px 12px; border-top:1px solid var(--footer-border); display:flex; justify-content:space-between; align-items:flex-end; }
  .card-font-labels { font-size:9.5px; color:var(--text-dim); }
  .card-font-labels .tag { color:var(--accent); font-weight:600; }
  .card-font-labels div { margin-bottom:2px; }
  .card-font-labels div:last-child { margin-bottom:0; }
  .card-actions { display:flex; gap:4px; }
  .card-actions button { border:none; border-radius:5px; padding:4px 8px; cursor:pointer; transition:all 0.15s; font-family:'Inter',sans-serif; }
  .btn-star { background:var(--surface-hover); font-size:12px; color:var(--text-dim); }
  .btn-star:hover { background:rgba(244,180,0,0.2); color:#f4b400; }
  .card.starred .btn-star { background:#f4b400; color:#1a1a1a; }
  .btn-dup { background:var(--surface-hover); font-size:10px; color:var(--text-dim); }
  .btn-dup:hover { opacity:0.8; }
  .btn-del { background:rgba(255,80,80,0.1); font-size:10px; color:#e07060; }
  .btn-del:hover { background:rgba(255,80,80,0.2); }
  @media (max-width:560px) { .grid { grid-template-columns:1fr; } .controls { flex-direction:column; } .control-group { flex:1 1 100%; } }
</style>
</head>
<body>
<div class="top-bar"><div class="top-bar-inner"><div><h1>UI Workbench</h1><div class="sub">Bondwood — App Preview &amp; Typography Explorer</div></div><div class="top-bar-actions"><button class="btn-fav-filter" id="btnFavFilter" style="display:none;" onclick="toggleFavFilter()"></button><span class="card-count" id="cardCount">0 cards</span><button class="btn-save" id="btnSave" onclick="saveState()" title="Save current layout to browser">Save</button><button class="btn-save" id="btnLoad" style="display:none;" onclick="loadState()" title="Restore saved layout">Load</button><button class="btn-random" onclick="addRandomCards()" title="Add 12 random preview cards">Random 12</button><span class="save-indicator" id="saveIndicator"></span><button class="btn-clear" id="btnClear" style="display:none;" onclick="clearAll()">Clear all</button><div class="theme-toggle-wrap"><span class="theme-toggle-label" id="themeLabel">Dark</span><div class="theme-toggle" id="themeToggle" onclick="toggleTheme()" title="Toggle light/dark mode"></div></div></div></div></div>
<div class="controls-wrap"><div class="controls"><div class="control-group"><label>App Preview</label><div class="custom-select" id="csApp"></div></div><div class="control-group wide"><label>District Brand</label><div class="custom-select" id="csBrand"></div></div><div class="control-group wide"><label>Display / Title Font</label><div class="custom-select" id="csDisplay"></div></div><div class="control-group wide"><label>Body / UI Font</label><div class="custom-select" id="csBody"></div></div><button class="btn-add" onclick="addCard()">+ Add Preview</button></div></div>
<div class="grid-wrap"><div class="grid" id="grid"></div><div class="empty-state" id="emptyState">Pick an app, brand, and fonts above — then click "+ Add Preview" to start comparing.</div></div>
<script>
const APPS = [
  {id:"payment-dash",name:"Payment Mgmt: Dashboard",group:"Payments",banner:"Payment Management"},
  {id:"budget-donut",name:"Budget Monitoring (Donut)",group:"Budget",banner:"Budget Monitoring"},
  {id:"budget-table",name:"Budget Monitoring (Table)",group:"Budget",banner:"Budget Monitoring"},
  {id:"bench-revenue",name:"Benchmarking: Revenues",group:"Benchmarking",banner:"MN K12 Benchmarking"},
  {id:"bench-salaries",name:"Benchmarking: Salaries & FTE",group:"Benchmarking",banner:"MN K12 Benchmarking"},
  {id:"bench-cohort",name:"Benchmarking: Cohort Survival",group:"Benchmarking",banner:"MN K12 Benchmarking"},
  {id:"bench-oe",name:"Benchmarking: Open Enrollment",group:"Benchmarking",banner:"MN K12 Benchmarking"},
];

const FONTS = [
  {name:"Archivo",import:"https://fonts.googleapis.com/css2?family=Archivo:wght@400;500;600;700;800&display=swap",family:"'Archivo',sans-serif"},
  {name:"Arvo",import:"https://fonts.googleapis.com/css2?family=Arvo:wght@400;700&display=swap",family:"'Arvo',serif"},
  {name:"Barlow",import:"https://fonts.googleapis.com/css2?family=Barlow:wght@400;500;600;700;800&display=swap",family:"'Barlow',sans-serif"},
  {name:"Bitter",import:"https://fonts.googleapis.com/css2?family=Bitter:wght@400;500;600;700;800&display=swap",family:"'Bitter',serif"},
  {name:"Cabin",import:"https://fonts.googleapis.com/css2?family=Cabin:wght@400;500;600;700&display=swap",family:"'Cabin',sans-serif"},
  {name:"Cal Sans",import:"https://fonts.googleapis.com/css2?family=Cal+Sans&display=swap",family:"'Cal Sans',sans-serif"},
  {name:"Crimson Text",import:"https://fonts.googleapis.com/css2?family=Crimson+Text:wght@400;600;700&display=swap",family:"'Crimson Text',serif"},
  {name:"DM Sans",import:"https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&display=swap",family:"'DM Sans',sans-serif"},
  {name:"DM Serif Display",import:"https://fonts.googleapis.com/css2?family=DM+Serif+Display&display=swap",family:"'DM Serif Display',serif"},
  {name:"EB Garamond",import:"https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;500;600;700;800&display=swap",family:"'EB Garamond',serif"},
  {name:"Exo 2",import:"https://fonts.googleapis.com/css2?family=Exo+2:wght@400;500;600;700;800&display=swap",family:"'Exo 2',sans-serif"},
  {name:"Fira Sans",import:"https://fonts.googleapis.com/css2?family=Fira+Sans:wght@400;500;600;700;800&display=swap",family:"'Fira Sans',sans-serif"},
  {name:"Fraunces",import:"https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800&display=swap",family:"'Fraunces',serif"},
  {name:"Geist",import:"https://fonts.googleapis.com/css2?family=Geist:wght@400;500;600;700;800&display=swap",family:"'Geist',sans-serif"},
  {name:"Google Sans Flex",import:"https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&family=Google+Sans+Text:wght@400;500;700&display=swap",family:"'Google Sans Text','Google Sans',system-ui,sans-serif"},
  {name:"IBM Plex Sans",import:"https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&display=swap",family:"'IBM Plex Sans',sans-serif"},
  {name:"Inter",import:"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap",family:"'Inter',sans-serif"},
  {name:"Josefin Sans",import:"https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@400;500;600;700&display=swap",family:"'Josefin Sans',sans-serif"},
  {name:"Karla",import:"https://fonts.googleapis.com/css2?family=Karla:wght@400;500;600;700;800&display=swap",family:"'Karla',sans-serif"},
  {name:"Lato",import:"https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&display=swap",family:"'Lato',sans-serif"},
  {name:"Lexend",import:"https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;600;700;800&display=swap",family:"'Lexend',sans-serif"},
  {name:"Libre Baskerville",import:"https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&display=swap",family:"'Libre Baskerville',serif"},
  {name:"Libre Franklin",import:"https://fonts.googleapis.com/css2?family=Libre+Franklin:wght@400;500;600;700;800&display=swap",family:"'Libre Franklin',sans-serif"},
  {name:"Lora",import:"https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600;700&display=swap",family:"'Lora',serif"},
  {name:"Manrope",import:"https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap",family:"'Manrope',sans-serif"},
  {name:"Merriweather",import:"https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700;900&display=swap",family:"'Merriweather',serif"},
  {name:"Montserrat",import:"https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap",family:"'Montserrat',sans-serif"},
  {name:"Mulish",import:"https://fonts.googleapis.com/css2?family=Mulish:wght@400;500;600;700;800&display=swap",family:"'Mulish',sans-serif"},
  {name:"Noto Sans",import:"https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;500;600;700;800&display=swap",family:"'Noto Sans',sans-serif"},
  {name:"Noto Serif",import:"https://fonts.googleapis.com/css2?family=Noto+Serif:wght@400;500;600;700&display=swap",family:"'Noto Serif',serif"},
  {name:"Nunito",import:"https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800&display=swap",family:"'Nunito',sans-serif"},
  {name:"Nunito Sans",import:"https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;500;600;700;800&display=swap",family:"'Nunito Sans',sans-serif"},
  {name:"Open Sans",import:"https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700;800&display=swap",family:"'Open Sans',sans-serif"},
  {name:"Oswald",import:"https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&display=swap",family:"'Oswald',sans-serif"},
  {name:"Outfit",import:"https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&display=swap",family:"'Outfit',sans-serif"},
  {name:"Overpass",import:"https://fonts.googleapis.com/css2?family=Overpass:wght@400;500;600;700;800&display=swap",family:"'Overpass',sans-serif"},
  {name:"Playfair Display",import:"https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700;800;900&display=swap",family:"'Playfair Display',serif"},
  {name:"Plus Jakarta Sans",import:"https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap",family:"'Plus Jakarta Sans',sans-serif"},
  {name:"Poppins",import:"https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap",family:"'Poppins',sans-serif"},
  {name:"PT Sans",import:"https://fonts.googleapis.com/css2?family=PT+Sans:wght@400;700&display=swap",family:"'PT Sans',sans-serif"},
  {name:"PT Serif",import:"https://fonts.googleapis.com/css2?family=PT+Serif:wght@400;700&display=swap",family:"'PT Serif',serif"},
  {name:"Quicksand",import:"https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap",family:"'Quicksand',sans-serif"},
  {name:"Raleway",import:"https://fonts.googleapis.com/css2?family=Raleway:wght@400;500;600;700;800&display=swap",family:"'Raleway',sans-serif"},
  {name:"Reddit Sans",import:"https://fonts.googleapis.com/css2?family=Reddit+Sans:wght@400;500;600;700;800&display=swap",family:"'Reddit Sans',sans-serif"},
  {name:"Roboto",import:"https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap",family:"'Roboto',sans-serif"},
  {name:"Roboto Slab",import:"https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@400;500;600;700;800&display=swap",family:"'Roboto Slab',serif"},
  {name:"Rubik",import:"https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;600;700;800&display=swap",family:"'Rubik',sans-serif"},
  {name:"Sora",import:"https://fonts.googleapis.com/css2?family=Sora:wght@400;500;600;700;800&display=swap",family:"'Sora',sans-serif"},
  {name:"Source Sans Pro",import:"https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;500;600;700;800&display=swap",family:"'Source Sans 3',sans-serif"},
  {name:"Source Serif Pro",import:"https://fonts.googleapis.com/css2?family=Source+Serif+4:wght@400;500;600;700;800&display=swap",family:"'Source Serif 4',serif"},
  {name:"Space Grotesk",import:"https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap",family:"'Space Grotesk',sans-serif"},
  {name:"Spline Sans",import:"https://fonts.googleapis.com/css2?family=Spline+Sans:wght@400;500;600;700&display=swap",family:"'Spline Sans',sans-serif"},
  {name:"Titillium Web",import:"https://fonts.googleapis.com/css2?family=Titillium+Web:wght@400;600;700&display=swap",family:"'Titillium Web',sans-serif"},
  {name:"Urbanist",import:"https://fonts.googleapis.com/css2?family=Urbanist:wght@400;500;600;700;800&display=swap",family:"'Urbanist',sans-serif"},
  {name:"Work Sans",import:"https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600;700;800&display=swap",family:"'Work Sans',sans-serif"},
  {name:"Zilla Slab",import:"https://fonts.googleapis.com/css2?family=Zilla+Slab:wght@400;500;600;700&display=swap",family:"'Zilla Slab',serif"},
];
const DISTRICTS = [
  {n:"0",name:"Bondwood Default",org:"",p:"#000000",s:"#0728eb",city:""},
  {n:"2396",name:"ACGC",org:"MREA",p:"#048081",s:"#ffffff",city:"Grove City"},
  {n:"2910",name:"Ada-Borup-West",org:"MREA",p:"#eb0000",s:"#000000",city:"Ada"},
  {n:"511",name:"Adrian",org:"MREA",p:"#032d9a",s:"#fefe10",city:"Adrian"},
  {n:"1",name:"Aitkin",org:"MREA",p:"#ad1e1d",s:"#000000",city:"Aitkin"},
  {n:"745",name:"Albany",org:"",p:"#380758",s:"#6d6d6d",city:"Albany"},
  {n:"241",name:"Albert Lea",org:"MREA",p:"#2f2a95",s:"#d82520",city:"Albert Lea"},
  {n:"242",name:"Alden-Conger",org:"MREA",p:"#b2353a",s:"#989898",city:"Alden"},
  {n:"206",name:"Alexandria",org:"MREA",p:"#dc1a32",s:"#fecd33",city:"Alexandria"},
  {n:"876",name:"Annandale",org:"",p:"#e20000",s:"#242424",city:"Annandale"},
  {n:"11",name:"Anoka-Hennepin",org:"AMSD",p:"#012d5d",s:"#012d5d",city:"Anoka"},
  {n:"261",name:"Ashby",org:"MREA",p:"#7b0019",s:"#fec421",city:"Ashby"},
  {n:"492",name:"Austin",org:"",p:"#95171b",s:"#ffffff",city:"Austin"},
  {n:"676",name:"Badger",org:"MREA",p:"#2d8741",s:"#000000",city:"Badger"},
  {n:"162",name:"Bagley",org:"MREA",p:"#8f2d2c",s:"#f0cb27",city:"Bagley"},
  {n:"146",name:"Barnesville",org:"MREA",p:"#429f44",s:"#ca532d",city:"Barnesville"},
  {n:"91",name:"Barnum",org:"MREA",p:"#3e0001",s:"#f9cf1f",city:"Barnum"},
  {n:"542",name:"Battle Lake",org:"MREA",p:"#002B5B",s:"#ffffff",city:"Battle Lake"},
  {n:"726",name:"Becker",org:"",p:"#1e69af",s:"#eeeeee",city:"Becker"},
  {n:"2364",name:"Belgrade-Brooten-Elrosa",org:"MREA",p:"#384ad3",s:"#000000",city:"Belgrade"},
  {n:"716",name:"Belle Plaine",org:"",p:"#72111a",s:"#000000",city:"Belle Plaine"},
  {n:"31",name:"Bemidji",org:"MREA",p:"#0000cc",s:"#000000",city:"Bemidji"},
  {n:"777",name:"Benson",org:"MREA",p:"#680000",s:"#ffcc00",city:"Benson"},
  {n:"786",name:"Bertha-Hewitt",org:"MREA",p:"#121549",s:"#ea1c25",city:"Bertha"},
  {n:"727",name:"Big Lake",org:"",p:"#004983",s:"#fdb813",city:"Big Lake"},
  {n:"2534",name:"Bird Island-Olivia-Lake Lillian",org:"MREA",p:"#f11020",s:"#000000",city:"Olivia"},
  {n:"32",name:"Blackduck",org:"MREA",p:"#0000cc",s:"#000000",city:"Blackduck"},
  {n:"756",name:"Blooming Prairie",org:"MREA",p:"#000000",s:"#919191",city:"Blooming Prairie"},
  {n:"271",name:"Bloomington",org:"AMSD",p:"#2f8dbc",s:"#2f8dbc",city:"Bloomington"},
  {n:"2860",name:"Blue Earth Area School",org:"MREA",p:"#7a0019",s:"#ffcc33",city:"Blue Earth"},
  {n:"314",name:"Braham",org:"",p:"#164468",s:"#2c9df2",city:"Braham"},
  {n:"181",name:"Brainerd",org:"MREA",p:"#0066b2",s:"#ffffff",city:"Brainerd"},
  {n:"2908",name:"Brandon-Evansville",org:"MREA",p:"#0039d0",s:"#eec60d",city:"Brandon"},
  {n:"846",name:"Breckenridge",org:"MREA",p:"#14bc00",s:"#ffffff",city:"Breckenridge"},
  {n:"286",name:"Brooklyn Center",org:"AMSD",p:"#612B9C",s:"#ffffff",city:"Brooklyn Center"},
  {n:"787",name:"Browerville",org:"MREA",p:"#b64f1d",s:"#313131",city:"Browerville"},
  {n:"801",name:"Browns Valley",org:"MREA",p:"#6f1a21",s:"#ffffff",city:"Browns Valley"},
  {n:"2159",name:"Buffalo Lk-Hector-Stewart Sc",org:"MREA",p:"#0139ad",s:"#ffffff",city:"Hector"},
  {n:"877",name:"Buffalo-Hanover-Montrose",org:"AMSD",p:"#48308A",s:"#ffffff",city:"Buffalo"},
  {n:"191",name:"Burnsville",org:"AMSD",p:"#FFD334",s:"#000000",city:"Burnsville"},
  {n:"836",name:"Butterfield",org:"MREA",p:"#e51b20",s:"#000000",city:"Butterfield"},
  {n:"531",name:"Byron",org:"",p:"#ffc60b",s:"#3a3a3c",city:"Byron"},
  {n:"299",name:"Caledonia",org:"MREA",p:"#c5b357",s:"#271d05",city:"Caledonia"},
  {n:"911",name:"Cambridge-Isanti",org:"MREA",p:"#00338d",s:"#c60c30",city:"Cambridge"},
  {n:"852",name:"Campbell-Tintah",org:"MREA",p:"#5519ba",s:"#f1c40f",city:"Campbell"},
  {n:"891",name:"Canby",org:"MREA",p:"#1f27b4",s:"#ec6b14",city:"Canby"},
  {n:"252",name:"Cannon Falls",org:"MREA",p:"#b92127",s:"#000000",city:"Cannon Falls"},
  {n:"93",name:"Carlton",org:"",p:"#4d0000",s:"#ee4c24",city:"Carlton"},
  {n:"115",name:"Cass Lake-Bena",org:"MREA",p:"#21448a",s:"#983636",city:"Cass Lake"},
  {n:"2754",name:"Cedar Mountain",org:"MREA",p:"#70cffa",s:"#222222",city:"Morgan"},
  {n:"12",name:"Centennial",org:"AMSD",p:"#D2112A",s:"#ffffff",city:"Circle Pines"},
  {n:"108",name:"Central",org:"",p:"#e66425",s:"#cf7f00",city:"Norwood Young America"},
  {n:"227",name:"Chatfield",org:"MREA",p:"#76232f",s:"#eaeaea",city:"Chatfield"},
  {n:"2144",name:"Chisago Lakes",org:"",p:"#00502f",s:"#d1cf89",city:"Chisago City"},
  {n:"695",name:"Chisholm",org:"MREA",p:"#df0001",s:"#0802f6",city:"Chisholm"},
  {n:"771",name:"Chokio-Alberta",org:"MREA",p:"#d00707",s:"#1958b2",city:"Chokio"},
  {n:"2311",name:"Clearbrook-Gonvick",org:"MREA",p:"#f3a516",s:"#000000",city:"Clearbrook"},
  {n:"391",name:"Cleveland",org:"MREA",p:"#d04100",s:"#ffffff",city:"Cleveland"},
  {n:"592",name:"Climax-Shelly",org:"MREA",p:"#c0c0c0",s:"#000000",city:"Climax"},
  {n:"2888",name:"Clinton-Graceville-Beardsley",org:"MREA",p:"#1d4589",s:"#a7a9ac",city:"Clinton"},
  {n:"94",name:"Cloquet",org:"MREA",p:"#104995",s:"#ffffff",city:"Cloquet"},
  {n:"13",name:"Columbia Heights",org:"AMSD",p:"#22284e",s:"#fdd009",city:"Columbia Heights"},
  {n:"81",name:"Comfrey",org:"",p:"#02546d",s:"#000000",city:"Comfrey"},
  {n:"166",name:"Cook County",org:"MREA",p:"#0000cd",s:"#e5ac0c",city:"Grand Marais"},
  {n:"95",name:"Cromwell-Wright",org:"MREA",p:"#610066",s:"#000000",city:"Cromwell"},
  {n:"593",name:"Crookston",org:"MREA",p:"#041e42",s:"#f1c400",city:"Crookston"},
  {n:"182",name:"Crosby-Ironton",org:"",p:"#6a1c33",s:"#a8a8a8",city:"Crosby"},
  {n:"466",name:"Dassel-Cokato",org:"MREA",p:"#1b2754",s:"#000000",city:"Cokato"},
  {n:"378",name:"Dawson-Boyd",org:"MREA",p:"#000000",s:"#fdbc3d",city:"Dawson"},
  {n:"317",name:"Deer River",org:"MREA",p:"#3a5dae",s:"#e5ebf7",city:"Deer River"},
  {n:"879",name:"Delano",org:"",p:"#cb4506",s:"#000000",city:"Delano"},
  {n:"22",name:"Detroit Lakes",org:"MREA",p:"#19346a",s:"#ffffff",city:"Detroit Lakes"},
  {n:"2164",name:"Dilworth-Glyndon-Felton",org:"MREA",p:"#383a3b",s:"#2c2d2f",city:"Dilworth"},
  {n:"533",name:"Dover-Eyota",org:"MREA",p:"#6e0a22",s:"#eaae26",city:"Eyota"},
  {n:"709",name:"Duluth",org:"AMSD",p:"#c42630",s:"#ffffff",city:"Duluth"},
  {n:"595",name:"EaSt. Grand Forks",org:"MREA",p:"#30600e",s:"#ffffff",city:"East Grand Forks"},
  {n:"2580",name:"East Central",org:"",p:"#003da5",s:"#020817",city:"Finlayson"},
  {n:"112",name:"Eastern Carver County",org:"AMSD",p:"#012f6b",s:"#B7A56E",city:"Chaska"},
  {n:"272",name:"Eden Prairie",org:"AMSD",p:"#D5292F",s:"#000000",city:"Eden Prairie"},
  {n:"463",name:"Eden Valley-Watkins",org:"MREA",p:"#0a1b4e",s:"#ffffff",city:"Eden Valley"},
  {n:"581",name:"Edgerton",org:"MREA",p:"#a61518",s:"#000000",city:"Edgerton"},
  {n:"273",name:"Edina",org:"AMSD",p:"#005826",s:"#ffaf1d",city:"Edina"},
  {n:"728",name:"Elk River",org:"AMSD",p:"#414284",s:"#414284",city:"Elk River"},
  {n:"514",name:"Ellsworth",org:"MREA",p:"#621c0d",s:"#f4b12f",city:"Ellsworth"},
  {n:"696",name:"Ely",org:"MREA",p:"#b80000",s:"#000000",city:"Ely"},
  {n:"99",name:"Esko",org:"MREA",p:"#351f0b",s:"#f2d449",city:"Esko"},
  {n:"2752",name:"Fairmont Area",org:"MREA",p:"#7c0601",s:"#ffffff",city:"Fairmont"},
  {n:"656",name:"Faribault",org:"",p:"#124736",s:"#d0d2d4",city:"Faribault"},
  {n:"192",name:"Farmington",org:"AMSD",p:"#B6441A",s:"#ffffff",city:"Farmington"},
  {n:"544",name:"Fergus Falls",org:"MREA",p:"#efbb45",s:"#6b2525",city:"Fergus Falls"},
  {n:"599",name:"Fertile-Beltrami",org:"MREA",p:"#000033",s:"#92000a",city:"Fertile"},
  {n:"2198",name:"Fillmore Central",org:"MREA",p:"#015f60",s:"#000000",city:"Preston"},
  {n:"600",name:"Fisher",org:"MREA",p:"#0b2f5b",s:"#1d4379",city:"Fisher"},
  {n:"698",name:"Floodwood",org:"MREA",p:"#4b1670",s:"#fabf37",city:"Floodwood"},
  {n:"51",name:"Foley",org:"MREA",p:"#015eb7",s:"#000000",city:"Foley"},
  {n:"831",name:"Forest Lake",org:"",p:"#96002e",s:"#ffd200",city:"Forest Lake"},
  {n:"601",name:"Fosston",org:"MREA",p:"#690000",s:"#ffffff",city:"Fosston"},
  {n:"323",name:"Franconia",org:"",p:"#0d7d4f",s:"#fcc00f",city:""},
  {n:"23",name:"Frazee-Vergas",org:"MREA",p:"#056940",s:"#056940",city:"Frazee"},
  {n:"14",name:"Fridley",org:"AMSD",p:"#000000",s:"#FCD450",city:"Fridley"},
  {n:"505",name:"Fulda",org:"MREA",p:"#ef001c",s:"#ffffff",city:"Fulda"},
  {n:"2365",name:"GFW",org:"MREA",p:"#ca0d14",s:"#b7b481",city:"Gibbon"},
  {n:"2859",name:"Glencoe-Silver Lake",org:"",p:"#660099",s:"#ffffff",city:"Glencoe"},
  {n:"2886",name:"Glenville-Emmons",org:"MREA",p:"#1e327b",s:"#a1a3a4",city:"Glenville"},
  {n:"253",name:"Goodhue",org:"MREA",p:"#582c83",s:"#000000",city:"Goodhue"},
  {n:"561",name:"Goodridge",org:"MREA",p:"#223a73",s:"#c29f45",city:"Goodridge"},
  {n:"2536",name:"Granada Huntley-EaSt. Chain",org:"MREA",p:"#2e0a42",s:"#ffffff",city:"Granada"},
  {n:"495",name:"Grand Meadow",org:"MREA",p:"#48308A",s:"#ffffff",city:"Grand Meadow"},
  {n:"318",name:"Grand Rapids",org:"MREA",p:"#607583",s:"#242424",city:"Grand Rapids"},
  {n:"2683",name:"Greenbush-Middle River",org:"MREA",p:"#0c3b2e",s:"#ffffff",city:"Greenbush"},
  {n:"316",name:"Greenway",org:"MREA",p:"#0d814b",s:"#ffffff",city:"Coleraine"},
  {n:"447",name:"Grygla",org:"MREA",p:"#0f00c6",s:"#000000",city:"Grygla"},
  {n:"768",name:"Hancock",org:"MREA",p:"#660e0e",s:"#e0d6a7",city:"Hancock"},
  {n:"200",name:"Hastings",org:"AMSD",p:"#092969",s:"#ffce33",city:"Hastings"},
  {n:"150",name:"Hawley",org:"MREA",p:"#6d191a",s:"#fdb726",city:"Hawley"},
  {n:"203",name:"Hayfield",org:"MREA",p:"#143dcf",s:"#ffffff",city:"Hayfield"},
  {n:"402",name:"Hendricks",org:"MREA",p:"#c81313",s:"#ffffff",city:"Hendricks"},
  {n:"545",name:"Henning",org:"MREA",p:"#f48c0f",s:"#000000",city:"Henning"},
  {n:"264",name:"Herman-Norcross",org:"",p:"#ea5500",s:"#000000",city:"Herman"},
  {n:"700",name:"Hermantown",org:"MREA",p:"#052b48",s:"#cb9a2b",city:"Hermantown"},
  {n:"330",name:"Heron Lake-Okabena",org:"MREA",p:"#243af7",s:"#c5cfd2",city:"Okabena"},
  {n:"701",name:"Hibbing",org:"MREA",p:"#112846",s:"#ffffff",city:"Hibbing"},
  {n:"2",name:"Hill City",org:"MREA",p:"#5c1a86",s:"#ffffff",city:"Hill City"},
  {n:"671",name:"Hills-Beaver Creek",org:"MREA",p:"#0a217f",s:"#fd0001",city:"Hills"},
  {n:"2165",name:"Hinckley-Finlayson",org:"",p:"#000000",s:"#ff0000",city:"Hinckley"},
  {n:"738",name:"Holdingford",org:"MREA",p:"#1c5b2e",s:"#000000",city:"Holdingford"},
  {n:"270",name:"Hopkins",org:"AMSD",p:"#0068a8",s:"#0068a8",city:"Hopkins"},
  {n:"294",name:"Houston",org:"MREA",p:"#e81610",s:"#e81610",city:"Houston"},
  {n:"2687",name:"Howard Lake-Waverly-Winsted",org:"MREA",p:"#002a54",s:"#ffc20e",city:"Howard Lake"},
  {n:"423",name:"Hutchinson",org:"MREA",p:"#000000",s:"#fdbc3d",city:"Hutchinson"},
  {n:"361",name:"International Falls",org:"MREA",p:"#5c3181",s:"#feb625",city:"International Falls"},
  {n:"199",name:"Inver Grove Heights",org:"AMSD",p:"#007DC2",s:"#ee2e24",city:"Inver Grove Heights"},
  {n:"473",name:"Isle",org:"",p:"#c20e2f",s:"#fcb818",city:"Isle"},
  {n:"403",name:"Ivanhoe",org:"MREA",p:"#d42531",s:"#000000",city:"Ivanhoe"},
  {n:"2895",name:"Jackson County Central",org:"MREA",p:"#103357",s:"#ffffff",city:"Jackson"},
  {n:"2835",name:"Janesville-Waldorf-Pemberton",org:"MREA",p:"#1d76a9",s:"#2d95cb",city:"Janesville"},
  {n:"717",name:"Jordan",org:"",p:"#7a0019",s:"#ffce31",city:"Jordan"},
  {n:"204",name:"Kasson-Mantorville",org:"",p:"#383e89",s:"#fd3734",city:"Kasson"},
  {n:"36",name:"Kelliher",org:"MREA",p:"#670212",s:"#eaeaea",city:"Kelliher"},
  {n:"2172",name:"Kenyon-Wanamingo",org:"",p:"#d82332",s:"#000000",city:"Kenyon"},
  {n:"775",name:"Kerkhoven-Murdock-Sunburg",org:"MREA",p:"#25347b",s:"#eb2227",city:"Kerkhoven"},
  {n:"739",name:"Kimball",org:"MREA",p:"#000691",s:"#e7c02b",city:"Kimball"},
  {n:"2137",name:"Kingsland",org:"MREA",p:"#000000",s:"#ffffff",city:"Spring Valley"},
  {n:"2171",name:"Kittson Central",org:"MREA",p:"#741d14",s:"#cdb586",city:"Hallock"},
  {n:"300",name:"La Crescent-Hokah",org:"MREA",p:"#4cba18",s:"#101820",city:"La Crescent"},
  {n:"2853",name:"Lac Qui Parle Valley",org:"MREA",p:"#d40131",s:"#000000",city:"Madison"},
  {n:"404",name:"Lake Benton",org:"MREA",p:"#ffcc02",s:"#000000",city:"Lake Benton"},
  {n:"813",name:"Lake City",org:"MREA",p:"#ea5528",s:"#ffffff",city:"Lake City"},
  {n:"2071",name:"Lake Crystal-Wellcome Memorial",org:"MREA",p:"#002d72",s:"#ffffff",city:"Lake Crystal"},
  {n:"390",name:"Lake Of The Woods",org:"MREA",p:"#5b1929",s:"#fdba2d",city:"Baudette"},
  {n:"2889",name:"Lake Park Audubon",org:"MREA",p:"#c9203b",s:"#000000",city:"Lake Park"},
  {n:"381",name:"Lake Superior",org:"MREA",p:"#8f302e",s:"#384259",city:"Two Harbors"},
  {n:"2167",name:"Lakeview",org:"MREA",p:"#000000",s:"#0f1e7b",city:"Cottonwood"},
  {n:"194",name:"Lakeville",org:"AMSD",p:"#AF2936",s:"#aa1f2e",city:"Lakeville"},
  {n:"356",name:"Lancaster",org:"MREA",p:"#97161b",s:"#0b360b",city:"Lancaster"},
  {n:"229",name:"Lanesboro",org:"MREA",p:"#f68748",s:"#000000",city:"Lanesboro"},
  {n:"306",name:"Laporte",org:"MREA",p:"#350656",s:"#ffcc02",city:"Laporte"},
  {n:"2397",name:"Le Sueur-Henderson",org:"",p:"#1f4b9e",s:"#fcb800",city:"Le Sueur"},
  {n:"499",name:"Leroy-Ostrander",org:"",p:"#ab0d01",s:"#ffffff",city:"LeRoy"},
  {n:"424",name:"Lester Prairie",org:"MREA",p:"#690e20",s:"#ffbd53",city:"Lester Prairie"},
  {n:"857",name:"Lewiston-Altura",org:"MREA",p:"#c01309",s:"#000000",city:"Lewiston"},
  {n:"465",name:"Litchfield",org:"",p:"#17aa59",s:"#000000",city:"Litchfield"},
  {n:"482",name:"Little Falls",org:"MREA",p:"#48308A",s:"#ffffff",city:"Little Falls"},
  {n:"362",name:"Littlefork-Big Falls",org:"MREA",p:"#c14d00",s:"#474747",city:"Littlefork"},
  {n:"2753",name:"Long Prairie-Grey Eagle",org:"MREA",p:"#0077c0",s:"#231f20",city:"Long Prairie"},
  {n:"2184",name:"Luverne",org:"MREA",p:"#e90c17",s:"#ffffff",city:"Luverne"},
  {n:"497",name:"Lyle",org:"",p:"#004ed6",s:"#ffffff",city:"Lyle"},
  {n:"415",name:"Lynd",org:"MREA",p:"#ff0000",s:"#000000",city:"Lynd"},
  {n:"238",name:"Mabel-Canton",org:"MREA",p:"#000098",s:"#ff0000",city:"Mabel"},
  {n:"2180",name:"Maccray",org:"MREA",p:"#171796",s:"#06af43",city:"Clara City"},
  {n:"837",name:"Madelia",org:"MREA",p:"#f15619",s:"#ffffff",city:"Madelia"},
  {n:"432",name:"Mahnomen",org:"MREA",p:"#036064",s:"#000000",city:"Mahnomen"},
  {n:"832",name:"Mahtomedi",org:"AMSD",p:"#002369",s:"#000000",city:"Mahtomedi"},
  {n:"77",name:"Mankato",org:"",p:"#ff3019",s:"#cbe1ec",city:"Mankato"},
  {n:"881",name:"Maple Lake",org:"MREA",p:"#045708",s:"#000000",city:"Maple Lake"},
  {n:"2135",name:"Maple River",org:"MREA",p:"#0a974b",s:"#0058b8",city:"Mapleton"},
  {n:"413",name:"Marshall",org:"MREA",p:"#fa4614",s:"#000000",city:"Marshall"},
  {n:"441",name:"Marshall County Central",org:"MREA",p:"#72b4de",s:"#ffffff",city:"Newfolden"},
  {n:"2448",name:"Martin County West",org:"MREA",p:"#0000cd",s:"#000000",city:"Sherburn"},
  {n:"4",name:"Mcgregor",org:"MREA",p:"#000000",s:"#ad0015",city:"McGregor"},
  {n:"763",name:"Medford",org:"MREA",p:"#76232f",s:"#ffbf3f",city:"Medford"},
  {n:"740",name:"Melrose",org:"",p:"#514a95",s:"#ffdb3d",city:"Melrose"},
  {n:"821",name:"Menahga",org:"MREA",p:"#f57e20",s:"#000000",city:"Menahga"},
  {n:"2711",name:"Mesabi East",org:"MREA",p:"#3d3939",s:"#d41f1f",city:"Aurora"},
  {n:"912",name:"Milaca",org:"MREA",p:"#df1f29",s:"#000000",city:"Milaca"},
  {n:"635",name:"Milroy",org:"",p:"#4b5aa7",s:"#ffffff",city:"Milroy"},
  {n:"1.2",name:"Minneapolis",org:"AMSD",p:"#221b2f",s:"#000000",city:"Minneapolis"},
  {n:"414",name:"Minneota",org:"MREA",p:"#023792",s:"#fec901",city:"Minneota"},
  {n:"276",name:"Minnetonka",org:"AMSD",p:"#263777",s:"#263777",city:"Minnetonka"},
  {n:"2149",name:"Minnewaska",org:"MREA",p:"#005f9e",s:"#009448",city:"Glenwood"},
  {n:"129",name:"Montevideo",org:"MREA",p:"#22113b",s:"#f7bd18",city:"Montevideo"},
  {n:"882",name:"Monticello",org:"",p:"#000000",s:"#d50507",city:"Monticello"},
  {n:"152",name:"Moorhead",org:"MREA",p:"#14191d",s:"#fe5000",city:"Moorhead"},
  {n:"97",name:"Moose Lake",org:"MREA",p:"#cc0000",s:"#ffffff",city:"Moose Lake"},
  {n:"332",name:"Mora",org:"MREA",p:"#0237ad",s:"#c7cccd",city:"Mora"},
  {n:"2769",name:"Morris Area",org:"MREA",p:"#ff6600",s:"#000000",city:"Morris"},
  {n:"621",name:"Mounds View",org:"AMSD",p:"#005CAB",s:"#000000",city:"Shoreview"},
  {n:"712",name:"Mountain Iron-Buhl",org:"MREA",p:"#a60000",s:"#000000",city:"Mountain Iron"},
  {n:"173",name:"Mountain Lake",org:"MREA",p:"#7e2326",s:"#818286",city:"Mountain Lake"},
  {n:"2169",name:"Murray County Central",org:"MREA",p:"#542b7b",s:"#000000",city:"Slayton"},
  {n:"319",name:"Nashwauk-Keewatin",org:"MREA",p:"#232d65",s:"#f16c21",city:"Nashwauk"},
  {n:"707",name:"Nett Lake",org:"MREA",p:"#002688",s:"#bbdffa",city:"Nett Lake"},
  {n:"308",name:"Nevis",org:"MREA",p:"#034a01",s:"#ffcc33",city:"Nevis"},
  {n:"345",name:"New London-Spicer",org:"MREA",p:"#ffda00",s:"#ffda00",city:"New London"},
  {n:"721",name:"New Prague Area Schools",org:"",p:"#8b2332",s:"#000000",city:"New Prague"},
  {n:"2168",name:"New Richland-Hartland-Ellendale-Geneva",org:"MREA",p:"#bc0217",s:"#000000",city:"New Richland"},
  {n:"88",name:"New Ulm",org:"MREA",p:"#661122",s:"#ffffff",city:"New Ulm"},
  {n:"553",name:"New York Mills",org:"MREA",p:"#002366",s:"#ff0000",city:"New York Mills"},
  {n:"507",name:"Nicollet",org:"MREA",p:"#22409a",s:"#000000",city:"Nicollet"},
  {n:"2215",name:"Norman County East",org:"MREA",p:"#163398",s:"#fdcb01",city:"Twin Valley"},
  {n:"138",name:"North Branch",org:"MREA",p:"#de1a32",s:"#000000",city:"North Branch"},
  {n:"622",name:"North St. Paul-Maplewood Oakdale",org:"AMSD",p:"#EC1F27",s:"#ec1f27",city:"North Saint Paul"},
  {n:"659",name:"Northfield",org:"",p:"#731b36",s:"#ffca37",city:"Northfield"},
  {n:"118",name:"Northland Community Schools",org:"MREA",p:"#000000",s:"#c5b358",city:"Remer"},
  {n:"333",name:"Ogilvie",org:"MREA",p:"#eb8e24",s:"#241f1f",city:"Ogilvie"},
  {n:"480",name:"Onamia",org:"MREA",p:"#ffb71c",s:"#c20f2f",city:"Onamia"},
  {n:"278",name:"Orono",org:"AMSD",p:"#23408A",s:"#b5121b",city:"Long Lake"},
  {n:"2903",name:"Ortonville",org:"MREA",p:"#ef760e",s:"#000000",city:"Ortonville"},
  {n:"213",name:"Osakis",org:"MREA",p:"#cc0333",s:"#f1f1f1",city:"Osakis"},
  {n:"279",name:"Osseo",org:"AMSD",p:"#3C1E56",s:"#f7b03f",city:"Maple Grove"},
  {n:"761",name:"Owatonna",org:"",p:"#1f419a",s:"#ffffff",city:"Owatonna"},
  {n:"309",name:"Park Rapids",org:"MREA",p:"#eb6114",s:"#292929",city:"Park Rapids"},
  {n:"547",name:"Parkers Prairie",org:"MREA",p:"#ebab0b",s:"#710505",city:"Parkers Prairie"},
  {n:"741",name:"Paynesville",org:"MREA",p:"#37ab46",s:"#006b33",city:"Paynesville"},
  {n:"548",name:"Pelican Rapids",org:"MREA",p:"#f37021",s:"#000000",city:"Pelican Rapids"},
  {n:"186",name:"Pequot Lakes",org:"MREA",p:"#004c8a",s:"#c7381f",city:"Pequot Lakes"},
  {n:"549",name:"Perham-Dent",org:"MREA",p:"#fdb827",s:"#ffd401",city:"Perham"},
  {n:"484",name:"Pierz",org:"MREA",p:"#e01f28",s:"#000000",city:"Pierz"},
  {n:"116",name:"Pillager",org:"MREA",p:"#572932",s:"#ffcc33",city:"Pillager"},
  {n:"578",name:"Pine City",org:"MREA",p:"#1c5f30",s:"#ffffff",city:"Pine City"},
  {n:"255",name:"Pine Island",org:"MREA",p:"#510400",s:"#ffbf3f",city:"Pine Island"},
  {n:"25",name:"Pine Point",org:"MREA",p:"#056940",s:"#470200",city:"Ponsford"},
  {n:"2174",name:"Pine River-Backus",org:"MREA",p:"#ff6704",s:"#000000",city:"Pine River"},
  {n:"2689",name:"Pipestone Area",org:"MREA",p:"#0b5c19",s:"#ffffff",city:"Pipestone"},
  {n:"2899",name:"Plainview-Elgin-Millville",org:"MREA",p:"#6d6d6d",s:"#fecd08",city:"Plainview"},
  {n:"477",name:"Princeton",org:"MREA",p:"#f47c20",s:"#211e1f",city:"Princeton"},
  {n:"815",name:"Prinsburg",org:"",p:"#00295e",s:"#ffffff",city:""},
  {n:"719",name:"Prior Lake-Savage",org:"AMSD",p:"#000000",s:"#00496E",city:"Prior Lake"},
  {n:"704",name:"Proctor",org:"MREA",p:"#0b4c2a",s:"#000000",city:"Proctor"},
  {n:"195",name:"Randolph",org:"",p:"#005cb7",s:"#e05527",city:"Randolph"},
  {n:"38",name:"Red Lake",org:"MREA",p:"#aa0112",s:"#ffffff",city:"Red Lake"},
  {n:"2906",name:"Red Lake County Central",org:"MREA",p:"#ff1111",s:"#0512f6",city:"Oklee"},
  {n:"630",name:"Red Lake Falls",org:"MREA",p:"#6c53b5",s:"#e5af00",city:"Red Lake Falls"},
  {n:"2884",name:"Red Rock Central",org:"MREA",p:"#c10320",s:"#ffffff",city:"Lamberton"},
  {n:"256",name:"Red Wing",org:"MREA",p:"#5c4b7d",s:"#942828",city:"Red Wing"},
  {n:"2897",name:"Redwood Area",org:"MREA",p:"#c42121",s:"#ffffff",city:"Redwood Falls"},
  {n:"2890",name:"Renville County West",org:"MREA",p:"#182a54",s:"#fec52e",city:"Renville"},
  {n:"280",name:"Richfield",org:"AMSD",p:"#761a1c",s:"#ffffff",city:"Richfield"},
  {n:"281",name:"Robbinsdale",org:"AMSD",p:"#002D72",s:"#3598da",city:"New Hope"},
  {n:"535",name:"Rochester",org:"AMSD",p:"#002B5B",s:"#ffa913",city:"Rochester"},
  {n:"2909",name:"Rock Ridge",org:"MREA",p:"#00784d",s:"#000000",city:"Virginia"},
  {n:"883",name:"Rockford",org:"AMSD",p:"#037614",s:"#000000",city:"Rockford"},
  {n:"750",name:"Rocori",org:"",p:"#e6262b",s:"#ffffff",city:"Cold Spring"},
  {n:"682",name:"Roseau",org:"MREA",p:"#003005",s:"#ffffff",city:"Roseau"},
  {n:"196",name:"Rosemount-Apple Valley-Eagan",org:"AMSD",p:"#0079A7",s:"#f04e3e",city:"Rosemount"},
  {n:"623",name:"Roseville",org:"AMSD",p:"#ac0000",s:"#1a1a1a",city:"Roseville"},
  {n:"850",name:"Rothsay",org:"MREA",p:"#002998",s:"#ffc632",city:"Rothsay"},
  {n:"2907",name:"Round Lake-Brewster",org:"MREA",p:"#1e4eb9",s:"#ffffff",city:"Brewster"},
  {n:"485",name:"Royalton",org:"MREA",p:"#6b0002",s:"#c7aa70",city:"Royalton"},
  {n:"139",name:"Rush City",org:"",p:"#003896",s:"#ffcb11",city:"Rush City"},
  {n:"239",name:"Rushford-Peterson",org:"MREA",p:"#154734",s:"#fec52f",city:"Rushford"},
  {n:"2902",name:"Russell Tyler Ruthton",org:"MREA",p:"#204abf",s:"#ffffff",city:"Tyler"},
  {n:"748",name:"Sartell-St. Stephen",org:"",p:"#0e3f8e",s:"#ffffff",city:"Sartell"},
  {n:"743",name:"Sauk Centre",org:"MREA",p:"#781612",s:"#000000",city:"Sauk Centre"},
  {n:"47",name:"Sauk Rapids-Rice",org:"MREA",p:"#155733",s:"#ffcb31",city:"Sauk Rapids"},
  {n:"820",name:"Sebeka",org:"MREA",p:"#421f62",s:"#daa520",city:"Sebeka"},
  {n:"720",name:"Shakopee",org:"AMSD",p:"#2c2926",s:"#ee3e34",city:"Shakopee"},
  {n:"2310",name:"Sibley East",org:"MREA",p:"#dfab3b",s:"#000000",city:"Arlington"},
  {n:"84",name:"Sleepy Eye",org:"MREA",p:"#03470e",s:"#000000",city:"Sleepy Eye"},
  {n:"363",name:"South Koochiching",org:"MREA",p:"#254c8f",s:"#ffffff",city:"Northome"},
  {n:"6",name:"South St. Paul",org:"AMSD",p:"#121517",s:"#5E0B0E",city:"South Saint Paul"},
  {n:"833",name:"South Washington County",org:"AMSD",p:"#871530",s:"#000000",city:"Cottage Grove"},
  {n:"500",name:"Southland",org:"MREA",p:"#073f82",s:"#d71920",city:"Adams"},
  {n:"297",name:"Spring Grove",org:"MREA",p:"#003087",s:"#ffffff",city:"Spring Grove"},
  {n:"16",name:"Spring Lake Park",org:"AMSD",p:"#193369",s:"#dc1e35",city:"Spring Lake Park"},
  {n:"85",name:"Springfield",org:"MREA",p:"#520e1b",s:"#ff7f00",city:"Springfield"},
  {n:"282",name:"St. Anthony-New Brighton",org:"AMSD",p:"#024cb4",s:"#024cb4",city:"Saint Anthony"},
  {n:"858",name:"St. Charles",org:"MREA",p:"#000000",s:"#e16311",city:"Saint Charles"},
  {n:"75",name:"St. Clair",org:"MREA",p:"#005eb7",s:"#000000",city:"Saint Clair"},
  {n:"742",name:"St. Cloud",org:"AMSD",p:"#91C743",s:"#000000",city:"Waite Park"},
  {n:"15",name:"St. Francis",org:"",p:"#00205a",s:"#00205a",city:"Saint Francis"},
  {n:"840",name:"St. James",org:"MREA",p:"#d22f31",s:"#ffffff",city:"Saint James"},
  {n:"2142",name:"St. Louis County",org:"MREA",p:"#0d6046",s:"#000000",city:"Virginia"},
  {n:"283",name:"St. Louis Park",org:"AMSD",p:"#000000",s:"#FC9312",city:"Saint Louis Park"},
  {n:"885",name:"St. Michael-Albertville",org:"AMSD",p:"#00138B",s:"#000000",city:"Albertville"},
  {n:"625",name:"St. Paul",org:"AMSD",p:"#0075BF",s:"#ffffff",city:"Saint Paul"},
  {n:"508",name:"St. Peter",org:"MREA",p:"#002f5b",s:"#ffffff",city:"Saint Peter"},
  {n:"2170",name:"Staples-Motley",org:"MREA",p:"#d20d20",s:"#000000",city:"Staples"},
  {n:"2856",name:"Stephen-Argyle Central",org:"MREA",p:"#455968",s:"#f5c209",city:"Stephen"},
  {n:"534",name:"Stewartville",org:"",p:"#571523",s:"#fdbd3f",city:"Stewartville"},
  {n:"834",name:"Stillwater",org:"AMSD",p:"#D61B22",s:"#000000",city:"Stillwater"},
  {n:"486",name:"Swanville",org:"MREA",p:"#003698",s:"#3b72cc",city:"Swanville"},
  {n:"564",name:"Thief River Falls",org:"MREA",p:"#0054a6",s:"#ffc40d",city:"Thief River Falls"},
  {n:"2904",name:"Tracy Area",org:"MREA",p:"#1b1486",s:"#bf091d",city:"Tracy"},
  {n:"2905",name:"Tri-City United",org:"MREA",p:"#1a6092",s:"#cfd4db",city:"Montgomery"},
  {n:"2358",name:"Tri-County",org:"MREA",p:"#82caff",s:"#151b54",city:"Karlstad"},
  {n:"2125",name:"Triton",org:"MREA",p:"#8c011a",s:"#ffffff",city:"Dodge Center"},
  {n:"458",name:"Truman",org:"MREA",p:"#52006f",s:"#000000",city:"Truman"},
  {n:"914",name:"Ulen-Hitterdal",org:"MREA",p:"#00004c",s:"#ffde16",city:"Ulen"},
  {n:"550",name:"Underwood",org:"MREA",p:"#000000",s:"#f07600",city:"Underwood"},
  {n:"2134",name:"United South Central",org:"MREA",p:"#000080",s:"#d7021c",city:"Wells"},
  {n:"487",name:"Upsala",org:"MREA",p:"#95171b",s:"#000000",city:"Upsala"},
  {n:"818",name:"Verndale",org:"MREA",p:"#2e700e",s:"#ffffff",city:"Verndale"},
  {n:"811",name:"Wabasha-Kellogg",org:"MREA",p:"#e90c2b",s:"#000000",city:"Wabasha"},
  {n:"640",name:"Wabasso",org:"MREA",p:"#680918",s:"#daa521",city:"Wabasso"},
  {n:"110",name:"Waconia",org:"",p:"#672891",s:"#ffc700",city:"Waconia"},
  {n:"2155",name:"Wadena-Deer Creek",org:"MREA",p:"#024f9d",s:"#f8d246",city:"Wadena"},
  {n:"113",name:"Walker-Hackensack-Akeley",org:"MREA",p:"#003d79",s:"#eebf1f",city:"Walker"},
  {n:"2176",name:"Warren-Alvarado-Oslo",org:"MREA",p:"#ff6600",s:"#000000",city:"Warren"},
  {n:"690",name:"Warroad",org:"MREA",p:"#ffc10e",s:"#000000",city:"Warroad"},
  {n:"829",name:"Waseca",org:"MREA",p:"#021f72",s:"#fbd804",city:"Waseca"},
  {n:"111",name:"Watertown-Mayer",org:"MREA",p:"#003c71",s:"#bf0d3e",city:"Watertown"},
  {n:"2143",name:"Waterville-Elysian-Morristown",org:"MREA",p:"#009d4a",s:"#000000",city:"Waterville"},
  {n:"435",name:"Waubun-Ogema-White Earth",org:"MREA",p:"#036064",s:"#000000",city:"Waubun"},
  {n:"284",name:"Wayzata",org:"AMSD",p:"#00447C",s:"#eca901",city:"Plymouth"},
  {n:"2342",name:"West Central",org:"MREA",p:"#ba0c2f",s:"#9ea2a2",city:"Barrett"},
  {n:"197",name:"West St. Paul-Mendota Hts-Eagan",org:"AMSD",p:"#C10230",s:"#d0b786",city:"Mendota Heights"},
  {n:"2898",name:"Westbrook-Walnut Grove",org:"MREA",p:"#a70212",s:"#ffffff",city:"Westbrook"},
  {n:"277",name:"Westonka",org:"AMSD",p:"#1a1a1a",s:"#DA2B1F",city:"Minnetrista"},
  {n:"803",name:"Wheaton",org:"MREA",p:"#bf1e24",s:"#000000",city:"Wheaton"},
  {n:"624",name:"White Bear Lake",org:"AMSD",p:"#a63b02",s:"#ffffff",city:"White Bear Lake"},
  {n:"347",name:"Willmar",org:"MREA",p:"#e01f28",s:"#000000",city:"Willmar"},
  {n:"577",name:"Willow River",org:"MREA",p:"#ed1b24",s:"#020885",city:"Willow River"},
  {n:"2609",name:"Win-E-Mac",org:"MREA",p:"#0066bf",s:"#ea2634",city:"Erskine"},
  {n:"177",name:"Windom",org:"MREA",p:"#0133a0",s:"#ffb400",city:"Windom"},
  {n:"861",name:"Winona Area",org:"",p:"#fc4c02",s:"#000000",city:"Winona"},
  {n:"518",name:"Worthington",org:"MREA",p:"#cd0000",s:"#000000",city:"Worthington"},
  {n:"100",name:"Wrenshall",org:"",p:"#325da6",s:"#323232",city:"Wrenshall"},
  {n:"2190",name:"Yellow Medicine East",org:"MREA",p:"#531314",s:"#9a9f9e",city:"Granite Falls"},
  {n:"2805",name:"Zumbrota-Mazeppa",org:"MREA",p:"#0e1d41",s:"#9da1a2",city:"Zumbrota"}
];
// ═══════ HELPERS ═══════
function fi(name) { return FONTS.findIndex(f => f.name === name); }
const loadedFonts = new Set();
function loadFont(url) {
  if (!url || loadedFonts.has(url)) return;
  loadedFonts.add(url);
  const link = document.createElement("link");
  link.rel = "stylesheet"; link.href = url;
  document.head.appendChild(link);
}
function needsDarkText(hex) {
  if (!hex || hex.length < 7) return false;
  const r = parseInt(hex.slice(1,3),16), g = parseInt(hex.slice(3,5),16), b = parseInt(hex.slice(5,7),16);
  return (0.299*r + 0.587*g + 0.114*b) / 255 > 0.6;
}
function toggleTheme() {
  const html = document.documentElement;
  const next = html.getAttribute("data-theme") === "dark" ? "light" : "dark";
  html.setAttribute("data-theme", next);
  document.getElementById("themeLabel").textContent = next === "dark" ? "Dark" : "Light";
}

// ═══════ DROPDOWN BUILDERS ═══════
function closeAllDropdowns(except) {
  document.querySelectorAll(".custom-select.open").forEach(cs => { if (cs !== except) cs.classList.remove("open"); });
}
document.addEventListener("click", e => { if (!e.target.closest(".custom-select")) closeAllDropdowns(); });

function buildFontSelect(containerId, defaultIdx) {
  const container = document.getElementById(containerId);
  container.innerHTML = "";
  container.dataset.selectedIdx = defaultIdx;
  const trigger = document.createElement("div");
  trigger.className = "custom-select-trigger";
  trigger.textContent = FONTS[defaultIdx].name;
  container.appendChild(trigger);
  const dropdown = document.createElement("div");
  dropdown.className = "custom-select-dropdown";
  const search = document.createElement("input");
  search.className = "custom-select-search";
  search.placeholder = "Search fonts…";
  dropdown.appendChild(search);
  FONTS.forEach((f, i) => {
    loadFont(f.import);
    const opt = document.createElement("div");
    opt.className = "custom-select-option" + (i === defaultIdx ? " selected" : "");
    opt.dataset.idx = i;
    opt.innerHTML = '<span class="font-preview" style="font-family:'+f.family+'">Aa</span><span class="font-name">'+f.name+'</span>';
    opt.addEventListener("click", () => {
      container.dataset.selectedIdx = i;
      trigger.textContent = f.name;
      dropdown.querySelectorAll(".custom-select-option").forEach(o => o.classList.remove("selected"));
      opt.classList.add("selected");
      container.classList.remove("open");
      search.value = ""; filterOpts("");
    });
    dropdown.appendChild(opt);
  });
  container.appendChild(dropdown);
  function filterOpts(q) {
    const lower = q.toLowerCase();
    dropdown.querySelectorAll(".custom-select-option").forEach(o => {
      o.classList.toggle("hidden", !FONTS[o.dataset.idx].name.toLowerCase().includes(lower));
    });
  }
  search.addEventListener("input", () => filterOpts(search.value));
  trigger.addEventListener("click", e => { e.stopPropagation(); closeAllDropdowns(container); container.classList.toggle("open"); if (container.classList.contains("open")) setTimeout(() => search.focus(), 50); });
}

function buildBrandSelect(containerId) {
  const container = document.getElementById(containerId);
  container.innerHTML = "";
  container.dataset.selectedIdx = 0;
  const trigger = document.createElement("div");
  trigger.className = "custom-select-trigger";
  trigger.textContent = DISTRICTS[0].name;
  container.appendChild(trigger);
  const dropdown = document.createElement("div");
  dropdown.className = "custom-select-dropdown";
  const search = document.createElement("input");
  search.className = "custom-select-search";
  search.placeholder = "Search districts…";
  dropdown.appendChild(search);

  // Build sorted display order: [Bondwood Default] → [AMSD by district#] → [Others alpha]
  const parseNum = n => { const f = parseFloat(n); return isNaN(f) ? 99999 : f; };
  const sortedIndices = [];
  // 1) Bondwood Default (idx 0)
  sortedIndices.push(0);
  // 2) AMSD sorted by district number
  const amsd = [];
  const others = [];
  DISTRICTS.forEach((d, i) => {
    if (i === 0) return; // skip default
    if (d.org === 'AMSD') amsd.push(i);
    else others.push(i);
  });
  amsd.sort((a, b) => parseNum(DISTRICTS[a].n) - parseNum(DISTRICTS[b].n));
  others.sort((a, b) => DISTRICTS[a].name.localeCompare(DISTRICTS[b].name));
  sortedIndices.push(...amsd, ...others);

  // Add section headers
  function addDivider(text) {
    const div = document.createElement("div");
    div.style.cssText = "padding:6px 14px 4px;font-size:9px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--accent);border-top:1px solid var(--border);margin-top:2px;pointer-events:none;user-select:none;";
    div.className = "brand-divider";
    div.textContent = text;
    dropdown.appendChild(div);
  }

  let section = '';
  sortedIndices.forEach(i => {
    const d = DISTRICTS[i];
    const newSection = i === 0 ? 'default' : (d.org === 'AMSD' ? 'amsd' : 'other');
    if (newSection !== section) {
      section = newSection;
      if (newSection === 'amsd') addDivider('AMSD Districts (by #)');
      else if (newSection === 'other') addDivider('All Other Districts (A–Z)');
    }
    const opt = document.createElement("div");
    opt.className = "custom-select-option" + (i === 0 ? " selected" : "");
    opt.dataset.idx = i;
    const numLabel = d.n !== '0' ? '<span class="opt-sub">#'+d.n+'</span>' : '';
    const cityLabel = d.city ? '<span class="opt-sub">'+d.city+'</span>' : '';
    opt.innerHTML = '<span class="brand-swatch" style="background:'+d.p+'"></span><span class="opt-label">'+d.name+'</span>'+numLabel+cityLabel;
    opt.addEventListener("click", () => {
      container.dataset.selectedIdx = i;
      trigger.textContent = d.name;
      dropdown.querySelectorAll(".custom-select-option").forEach(o => o.classList.remove("selected"));
      opt.classList.add("selected");
      container.classList.remove("open");
      search.value = ""; filterOpts("");
    });
    dropdown.appendChild(opt);
  });
  container.appendChild(dropdown);
  function filterOpts(q) {
    const lower = q.toLowerCase();
    dropdown.querySelectorAll(".custom-select-option").forEach(o => {
      const d = DISTRICTS[o.dataset.idx];
      o.classList.toggle("hidden", !(d.name.toLowerCase().includes(lower) || d.city.toLowerCase().includes(lower) || d.n.includes(lower)));
    });
    // Hide/show section dividers based on whether they have visible children after them
    dropdown.querySelectorAll(".brand-divider").forEach(div => {
      let next = div.nextElementSibling;
      let anyVisible = false;
      while (next && !next.classList.contains("brand-divider")) {
        if (!next.classList.contains("hidden")) anyVisible = true;
        next = next.nextElementSibling;
      }
      div.style.display = anyVisible ? '' : 'none';
    });
  }
  search.addEventListener("input", () => filterOpts(search.value));
  trigger.addEventListener("click", e => { e.stopPropagation(); closeAllDropdowns(container); container.classList.toggle("open"); if (container.classList.contains("open")) setTimeout(() => search.focus(), 50); });
}

function buildAppSelect(containerId) {
  const container = document.getElementById(containerId);
  container.innerHTML = "";
  container.dataset.selectedIdx = 0;
  const trigger = document.createElement("div");
  trigger.className = "custom-select-trigger";
  trigger.textContent = APPS[0].name;
  container.appendChild(trigger);
  const dropdown = document.createElement("div");
  dropdown.className = "custom-select-dropdown";
  const search = document.createElement("input");
  search.className = "custom-select-search";
  search.placeholder = "Search apps…";
  dropdown.appendChild(search);
  APPS.forEach((a, i) => {
    const opt = document.createElement("div");
    opt.className = "custom-select-option" + (i === 0 ? " selected" : "");
    opt.dataset.idx = i;
    opt.innerHTML = '<span class="opt-label">'+a.name+'</span><span class="opt-sub">'+a.group+'</span>';
    opt.addEventListener("click", () => {
      container.dataset.selectedIdx = i;
      trigger.textContent = a.name;
      dropdown.querySelectorAll(".custom-select-option").forEach(o => o.classList.remove("selected"));
      opt.classList.add("selected");
      container.classList.remove("open");
      search.value = ""; filterOpts("");
    });
    dropdown.appendChild(opt);
  });
  container.appendChild(dropdown);
  function filterOpts(q) {
    const lower = q.toLowerCase();
    dropdown.querySelectorAll(".custom-select-option").forEach(o => {
      const a = APPS[o.dataset.idx];
      o.classList.toggle("hidden", !(a.name.toLowerCase().includes(lower) || a.group.toLowerCase().includes(lower)));
    });
  }
  search.addEventListener("input", () => filterOpts(search.value));
  trigger.addEventListener("click", e => { e.stopPropagation(); closeAllDropdowns(container); container.classList.toggle("open"); if (container.classList.contains("open")) setTimeout(() => search.focus(), 50); });
}
// ═══════ APP BODY TEMPLATES ═══════
function appBody(appId, df, bf, brand) {
  const dF = df.family, bF = bf.family;
  const p = brand.p, s = brand.s;
  const thC = needsDarkText(p) ? "#000" : "#fff";

  const miniStats = (items, accent) => {
    let h = '<div class="mini-stats" style="--stat-accent:'+accent+'">';
    items.forEach(([label, val, cls, sub]) => {
      h += '<div class="mini-stat"><div class="mini-stat-label" style="font-family:'+bF+'">'+label+'</div><div class="mini-stat-value'+(cls?' '+cls:'')+'" style="font-family:'+dF+'">'+val+'</div>'+(sub?'<div class="mini-stat-sub" style="font-family:'+bF+'">'+sub+'</div>':'')+'</div>';
    });
    return h + '</div>';
  };
  const miniTbl = (cols, rows) => {
    let h = '<table class="mini-table"><thead><tr style="background:'+p+';color:'+thC+'">';
    cols.forEach(c => { h += '<th style="font-family:'+bF+'">'+c+'</th>'; });
    h += '</tr></thead><tbody>';
    rows.forEach(r => {
      h += '<tr>';
      r.forEach((cell, ci) => {
        if (typeof cell === 'object') h += '<td>'+cell.html+'</td>';
        else h += '<td style="font-family:'+bF+(ci===0?';font-weight:600':'')+'">'+ cell+'</td>';
      });
      h += '</tr>';
    });
    return h + '</tbody></table>';
  };
  const badge = (text, cls) => '<span class="mini-badge '+cls+'" style="font-family:'+bF+'">'+text+'</span>';
  const tabs = (items, activeIdx) => {
    let h = '<div class="mini-tabs">';
    items.forEach((t,i) => {
      h += '<span class="mini-tab'+(i===activeIdx?' active':'')+'" style="'+(i===activeIdx?'background:'+p+';color:'+thC+';':'')+' font-family:'+bF+'">'+t+'</span>';
    });
    return h + '</div>';
  };
  const filter = (ph, selOpts) => {
    let h = '<div class="mini-filter-bar"><input class="mini-search" style="font-family:'+bF+'" placeholder="'+ph+'" disabled>';
    if (selOpts) h += '<select class="mini-select" style="font-family:'+bF+'" disabled><option>'+selOpts+'</option></select>';
    return h + '</div>';
  };
  const chart = (heights) => {
    let h = '<div class="mini-chart">';
    heights.forEach(ht => { h += '<div class="mini-chart-bar" style="height:'+ht+'%;background:'+p+'"></div>'; });
    return h + '</div>';
  };
  const sectionHdr = (title) => '<div class="mini-section-hdr" style="font-family:'+dF+'">'+title+'</div>';
  const dn = brand.name !== "Bondwood Default" ? brand.name : "";

  switch(appId) {
    case "payment-dash":
      return '<div class="app-module-title" style="font-family:'+dF+'">Dashboard</div><div class="app-subtitle" style="font-family:'+bF+'">All payment requests</div>'
        + miniStats([["Total RFPs","24"],["In Progress","8"],["Approved","12"],["Overdue","3","danger"],["Amount","$48K"]], p)
        + filter("Search RFPs…","All Statuses")
        + miniTbl(["RFP #","Vendor","Amount","Status"],[
          ["RFP-041","BSN Sports","$4,280",{html:badge("Approved","approved")}],
          ["RFP-040","Office Depot","$1,150",{html:badge("A/P Review","pending")}],
          ["RFP-039","Sparks Electric","$6,900",{html:badge("Draft","draft")}],
          ["RFP-038","Grainger Inc","$2,340",{html:badge("Approved","approved")}]
        ]);

    case "budget-donut":
      return miniStats([["Total Budget","$4.2M"],["YTD Spent","$2.8M"],["Encumbered","$420K"],["Remaining","$980K","green"]], p)
        + '<div class="mini-donut-grid">'
        + [{n:"General Fund",pct:67,r:"$594K"},{n:"Food Service",pct:82,r:"$122K"},{n:"Transportation",pct:55,r:"$234K"},{n:"Facilities",pct:91,r:"$31K"}].map(b =>
          '<div class="mini-bucket"><div class="mini-bucket-header" style="background:'+p+';color:'+thC+';font-family:'+dF+'">'+b.n+'</div><div class="mini-bucket-body"><canvas class="donut-canvas" data-pct="'+b.pct+'" data-p="'+p+'" width="48" height="48"></canvas><div class="mini-bucket-stats" style="font-family:'+bF+'"><strong>'+b.pct+'%</strong> utilized<br>Remaining: <strong>'+b.r+'</strong></div></div></div>'
        ).join('') + '</div>';

    case "budget-table":
      return miniStats([["Total Budget","$4.2M"],["YTD Spent","$2.8M"],["Encumbered","$420K"],["Remaining","$980K","green"]], p)
        + miniTbl(["Budget","Budgeted","Spent","Encumbered","Remaining","%"],[
          ["General Fund","$1.8M","$1.1M","$106K","$594K","67%"],
          ["Food Service","$680K","$510K","$48K","$122K","82%"],
          ["Transportation","$520K","$260K","$26K","$234K","55%"],
          ["Facilities","$340K","$290K","$19K","$31K","91%"]
        ]);

    case "bench-revenue":
      return '<div class="app-module-title" style="font-family:'+dF+'">Revenue Comparison</div><div class="app-subtitle" style="font-family:'+bF+'">General Education Revenue — FY2024 · Per ADM</div>'
        + miniStats([["Average","$7,842"],["Median","$7,650"],["Highest","$12,410","green"],["Lowest","$5,220","warn"]], p)
        + chart([90,75,72,68,65,60,55,50,45,42,38,32])
        + '<div style="margin-top:6px;font-size:7px;color:var(--text-faint);font-family:'+bF+'">12 districts · Sorted descending</div>';

    case "bench-salaries":
      return '<div class="app-module-title" style="font-family:'+dF+'">Salaries &amp; FTE</div>'
        + '<div class="mini-form-label" style="font-family:'+bF+';margin-bottom:4px">Salary Lane</div>'
        + buildSalaryLanes(bF, p, thC)
        + '<div class="salary-info" style="font-family:'+bF+'"><strong>Multiple lanes selected</strong> — salaries use median across steps within each district.</div>'
        + sectionHdr("District Comparison")
        + buildSalaryBars(dF, bF, p, s);

    case "bench-cohort":
      return '<div class="app-module-title" style="font-family:'+dF+'">Cohort Survival</div><div class="app-subtitle" style="font-family:'+bF+'">'+(dn||"Select a district")+' · Tracking cohorts across grades</div>'
        + tabs(["ADM Detail","Cohort ↘","Grade →","Year ↓"], 1)
        + sectionHdr("Cohort Statistics")
        + miniStats([["Terminal Survival","79.8%","green"],["Average","2,642","","ADM"],["Median","2,524","","ADM"],["Min","2,300","danger","2018"],["Max","3,076","green","2007"]], p)
        + sectionHdr("Average Daily Membership")
        + buildCohortGrid(dF, bF, p, thC, true);

    case "bench-oe":
      return '<div class="app-module-title" style="font-family:'+dF+'">Open Enrollment</div><div class="app-subtitle" style="font-family:'+bF+'">'+(dn||"Select a district")+' · Fiscal Year 2025</div>'
        + buildOEStats(dF, bF, p, thC)
        + sectionHdr("Butterfly Chart")
        + buildButterflyChart(dF, bF, p, s, thC);

    default: return '<div style="padding:20px;color:var(--text-faint)">Unknown app</div>';
  }
}

// ═══════ OPEN ENROLLMENT BUTTERFLY CHART ═══════
function buildOEStats(dF, bF, p, thC) {
  let h = '<div class="mini-stats" style="--stat-accent:'+p+'">';
  const items = [
    ["ADM","29,109","","total enrollment"],
    ["Resident","28,549","","98.1% of ADM"],
    ["Total In","560","green","1.9% of ADM"],
    ["Total Out","6,116","danger","17.6% of residents"],
    ["Net","-5,556","danger","net loss"],
    ["Partners","54","","districts"]
  ];
  items.forEach(([label, val, cls, sub]) => {
    h += '<div class="mini-stat"><div class="mini-stat-label" style="font-family:'+bF+'">'+label+'</div><div class="mini-stat-value'+(cls?' '+cls:'')+'" style="font-family:'+dF+'">'+val+'</div>'+(sub?'<div class="mini-stat-sub" style="font-family:'+bF+'">'+sub+'</div>':'')+'</div>';
  });
  h += '</div>';
  // Proportion bar
  h += '<div style="display:flex;height:14px;border-radius:4px;overflow:hidden;margin-bottom:10px;font-size:7px;font-weight:700;font-family:'+bF+'">';
  h += '<div style="flex:0 0 2%;background:#2B6D51;color:#fff;display:flex;align-items:center;padding:0 4px;white-space:nowrap">IN 560</div>';
  h += '<div style="flex:1;background:'+p+';color:'+thC+';display:flex;align-items:center;justify-content:center;white-space:nowrap">Resident 28,549 (81.0%)</div>';
  h += '<div style="flex:0 0 17%;background:#FA050F;color:#fff;display:flex;align-items:center;justify-content:flex-end;padding:0 4px;white-space:nowrap">OUT 6,116</div>';
  h += '</div>';
  return h;
}

function buildButterflyChart(dF, bF, p, s, thC) {
  // Sample partner district data, mimicking the screenshot
  const partners = [
    {name:"Lakeville",in:5,out:1,net:4,color:"#AF2936"},
    {name:"Inver Grove Hts",in:7,out:4,net:3,color:"#007DC2"},
    {name:"Anoka-Hennepin",in:31,out:33,net:-2,color:"#012d5d"},
    {name:"Mahtomedi",in:0,out:5,net:-5,color:"#002369"},
    {name:"South St. Paul",in:0,out:6,net:-6,color:"#121517"},
    {name:"Centennial",in:0,out:6,net:-6,color:"#D2112A"},
    {name:"White Bear Lake",in:0,out:7,net:-7,color:"#a63b02"},
    {name:"Burnsville",in:9,out:17,net:-8,color:"#FFD334"},
    {name:"Wayzata",in:6,out:14,net:-8,color:"#00447C"},
    {name:"Eastern Carver Co.",in:1,out:11,net:-10,color:"#012f6b"},
    {name:"Rosemount-AV-E",in:12,out:35,net:-23,color:"#0079A7"},
    {name:"Mounds View",in:7,out:42,net:-35,color:"#005CAB"},
    {name:"Spring Lake Park",in:6,out:66,net:-60,color:"#193369"},
    {name:"Roseville",in:13,out:109,net:-96,color:"#ac0000"},
    {name:"Brooklyn Center",in:29,out:137,net:-108,color:"#612B9C"},
    {name:"Osseo",in:67,out:190,net:-123,color:"#3C1E56"},
    {name:"Robbinsdale",in:92,out:971,net:-879,color:"#002D72"},
  ];
  const maxOut = Math.max(...partners.map(d => d.out));
  const maxIn = Math.max(...partners.map(d => d.in));
  const scale = 80; // max bar width in px

  let h = '<div class="butterfly-chart" style="font-family:'+bF+'">';
  // Header
  h += '<div class="butterfly-header"><div style="width:80px;text-align:right">← Enrolling In</div><div style="width:22px">In</div><div style="flex:1">District</div><div style="width:30px">Net</div><div style="width:22px">Out</div><div style="width:80px">Enrolling Out →</div></div>';
  partners.forEach(d => {
    const inW = maxIn > 0 ? Math.round((d.in / maxIn) * scale) : 0;
    const outW = maxOut > 0 ? Math.round((d.out / maxOut) * scale) : 0;
    const netColor = d.net >= 0 ? '#2B6D51' : '#FA050F';
    const netSign = d.net > 0 ? '+' : '';
    h += '<div class="butterfly-row">';
    h += '<div class="butterfly-in-bar-wrap"><div class="butterfly-in-bar" style="width:'+inW+'px;background:#2B6D51"></div></div>';
    h += '<div class="butterfly-in-val" style="color:var(--text-mid)">'+d.in+'</div>';
    h += '<div class="butterfly-district" style="background:'+d.color+'">'+d.name+'</div>';
    h += '<div class="butterfly-net" style="color:'+netColor+'">'+netSign+d.net+'</div>';
    h += '<div class="butterfly-out-val" style="color:var(--text-mid)">'+d.out+'</div>';
    h += '<div class="butterfly-out-bar-wrap"><div class="butterfly-out-bar" style="width:'+outW+'px;background:#FA050F"></div></div>';
    h += '</div>';
  });
  h += '</div>';
  return h;
}

// ═══════ COHORT DIAGONAL HEATMAP ═══════
function buildCohortGrid(dF, bF, p, thC, showCohort) {
  const years = ['07','08','09','10','11','12','13','14','15','16','17','18'];
  const grades = ['K','1','2','3','4','5','6','7','8','9','10','11','12'];
  // Base ADM values (simplified from screenshot)
  const baseK = [3076,3013,3004,3202,3231,3277,3417,3356,3226,3122,2962,2934];

  let h = '<div class="cohort-grid" style="font-family:'+bF+'"><table>';
  // Header
  h += '<thead><tr><th></th>';
  years.forEach(y => { h += '<th>20'+y+'</th>'; });
  h += '</tr></thead><tbody>';
  // Rows
  grades.forEach((gr, gi) => {
    h += '<tr><td class="grade-label">'+gr+'</td>';
    years.forEach((y, yi) => {
      const isOnDiag = showCohort && (yi === gi);
      const baseVal = baseK[yi] ? Math.round(baseK[yi] * (1 - gi*0.025 + (Math.random()-0.5)*0.04)) : '';
      if (isOnDiag) {
        const pct = gi === 0 ? '' : Math.round((1 - gi*0.016)*100) + '%';
        h += '<td><div class="cohort-cell" style="background:'+p+';padding:1px 2px;font-family:'+dF+'">' + baseVal + (pct ? '<span class="cohort-pct">'+pct+'</span>' : '') + '</div></td>';
      } else {
        const dimVal = baseVal || '';
        h += '<td style="color:var(--text-faint);font-size:6.5px">'+dimVal+'</td>';
      }
    });
    h += '</tr>';
  });
  // Summary row
  h += '<tr class="summary-row"><td class="grade-label row-label">Total</td>';
  years.forEach((y, yi) => {
    const total = Math.round(35701 - yi * 200 + (Math.random()-0.5)*400);
    h += '<td style="font-family:'+dF+'">'+total.toLocaleString()+'</td>';
  });
  h += '</tr>';
  h += '</tbody></table></div>';
  return h;
}

// ═══════ SALARY LANE TABS + BAR CHART ═══════
function buildSalaryLanes(bF, p, thC) {
  const lanes = ['All Lanes','BA','BA+10','BA+15','BA+20','BA+30','BA+40/MA','BA+45','BA+60','MA','MA+10','MA+15','MA+20','MA+30','MA+40/SP','MA+45','MA+60','SPEC','SPEC/PhD','PhD'];
  let h = '<div class="salary-lanes">';
  lanes.forEach((l, i) => {
    h += '<span class="salary-lane'+(i===0?' active':'')+'" style="'+(i===0?'background:'+p+';color:'+thC+';':'')+' font-family:'+bF+'">'+l+'</span>';
  });
  return h + '</div>';
}

function buildSalaryBars(dF, bF, p, s) {
  const districts = [
    {name:"Wayzata",color:"#00447C",entry:52308,median:91530,top:123452},
    {name:"Minnetonka",color:"#003865",entry:53366,median:88976,top:134840},
    {name:"Eden Prairie",color:"#8B1A1A",entry:53023,median:86362,top:124404},
    {name:"St. Louis Park",color:"#C5960C",entry:48967,median:83411,top:117783},
    {name:"Edina",color:"#2B6D51",entry:52926,median:82827,top:124444},
    {name:"Shakopee",color:"#C23B22",entry:52020,median:78744,top:126971},
    {name:"St. Paul",color:"#2F7EC0",entry:59756,median:73554,top:115427},
    {name:"Richfield",color:"#8B1A1A",entry:51675,median:70817,top:113765},
    {name:"Rosemount-AV-E",color:"#0079A7",entry:52400,median:70691,top:108909},
  ];
  const peerEntry = 52400, peerMedian = 82827, peerTop = 123452;
  const globalMin = 48000, globalMax = 135000;
  const range = globalMax - globalMin;

  let h = '<div class="salary-headers" style="font-family:'+bF+'">';
  h += '<span>Peer Med. Entry $'+peerEntry.toLocaleString()+'</span>';
  h += '<span>Peer Med. Salary $'+peerMedian.toLocaleString()+'</span>';
  h += '<span>Peer Med. Top $'+peerTop.toLocaleString()+'</span>';
  h += '</div>';

  districts.forEach((d, i) => {
    const entryPct = ((d.entry - globalMin) / range * 100);
    const medianPct = ((d.median - globalMin) / range * 100);
    const topPct = ((d.top - globalMin) / range * 100);
    const barLeft = entryPct;
    const barEntryW = medianPct - entryPct;
    const barTopW = topPct - medianPct;

    h += '<div class="salary-row">';
    h += '<div class="salary-rank" style="font-family:'+dF+'">'+(i+1)+'</div>';
    h += '<div class="salary-dot" style="background:'+d.color+'"></div>';
    h += '<div class="salary-name" style="font-family:'+bF+'">'+d.name+'</div>';
    h += '<div class="salary-entry-val" style="font-family:'+bF+'">$'+d.entry.toLocaleString()+'</div>';
    h += '<div class="salary-bar-wrap">';
    h += '<div style="width:'+barLeft+'%;flex-shrink:0"></div>';
    h += '<div class="salary-bar-entry" style="width:'+barEntryW+'%;background:'+d.color+'"></div>';
    h += '<div class="salary-bar-top" style="width:'+barTopW+'%;background:'+d.color+'"></div>';
    h += '<div class="salary-median-label" style="font-family:'+dF+';left:'+barLeft+'%;width:'+(barEntryW+barTopW)+'%">$'+d.median.toLocaleString()+'</div>';
    h += '</div>';
    h += '<div class="salary-top-val" style="font-family:'+bF+'">$'+d.top.toLocaleString()+'</div>';
    h += '</div>';
  });
  return h;
}
// ═══════ BUILD CARD HTML ═══════
function buildCardHTML(card) {
  const app = APPS[card.appIdx];
  const df = FONTS[card.displayIdx];
  const bf = FONTS[card.bodyIdx];
  const brand = DISTRICTS[card.brandIdx];
  const p = brand.p, s = brand.s;
  const thC = needsDarkText(p) ? "#000" : "#fff";
  const dls = df.name === "Cal Sans" ? "letter-spacing:0.5px;" : "";
  const hasLogo = brand.n !== "0";
  const logoPath = 'district-logos/' + brand.n + '.png';
  const defaultLogoPath = 'bondwood-logo-modern-dark.png';
  const hamId = 'ham-' + card.id;
  const overlayId = 'hamOverlay-' + card.id;

  // Navigation items based on app group
  const navItems = getNavItems(app);

  return '<div class="card '+(card.starred?'starred':'')+'" id="card-'+card.id+'" draggable="true" ondragstart="onDragStart(event,'+card.id+')" ondragover="onDragOver(event,'+card.id+')" ondragenter="onDragEnter(event)" ondragleave="onDragLeave(event)" ondrop="onDrop(event,'+card.id+')" ondragend="onDragEnd(event)">'
    + '<div class="drag-grip"><span></span><span></span><span></span><span></span><span></span><span></span></div>'
    + '<div class="fav-badge">★ Favorite</div>'
    // Hamburger overlay
    + '<div class="card-ham-overlay" id="'+overlayId+'" onclick="closeHamDrawer(\''+hamId+'\',\''+overlayId+'\')"></div>'
    // Hamburger slide-out drawer
    + '<div class="card-ham-drawer" id="'+hamId+'" style="background:'+p+'">'
    + '<div class="card-ham-drawer-inner">'
    // Header: Menu + X
    + '<div class="card-ham-header">'
    + '<div class="card-ham-title" style="font-family:'+df.family+';color:'+thC+'">Menu</div>'
    + '<button class="card-ham-close" onclick="closeHamDrawer(\''+hamId+'\',\''+overlayId+'\')" style="color:'+thC+'">'
    + '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="6" y1="6" x2="18" y2="18"/><line x1="6" y1="18" x2="18" y2="6"/></svg>'
    + '</button>'
    + '</div>'
    // Logo centered
    + '<div class="card-ham-logo-wrap" style="border-bottom-color:'+(needsDarkText(p)?'rgba(0,0,0,0.12)':'rgba(255,255,255,0.1)')+'">'
    + '<img src="'+(hasLogo ? logoPath : defaultLogoPath)+'" alt="" onerror="this.src=\''+defaultLogoPath+'\';this.onerror=null;">'
    + '</div>'
    // Navigation
    + '<div class="card-ham-section-label" style="font-family:'+bf.family+';color:'+(needsDarkText(p)?'rgba(0,0,0,0.4)':'rgba(255,255,255,0.45)')+'">Navigation</div>'
    + '<div class="card-ham-nav" style="font-family:'+bf.family+'">'
    + navItems.map((item, i) => '<div class="card-ham-nav-item'+(i===0?' active':'')+'" style="color:'+(i===0?thC:(needsDarkText(p)?'rgba(0,0,0,0.6)':'rgba(255,255,255,0.7)'))+(i===0?';background:'+(needsDarkText(p)?'rgba(0,0,0,0.1)':'rgba(255,255,255,0.12)'):'')+'">'+item+'</div>').join('')
    + '</div>'
    // Brand section
    + '<div class="card-ham-section-label" style="font-family:'+bf.family+';color:'+(needsDarkText(p)?'rgba(0,0,0,0.4)':'rgba(255,255,255,0.45)')+'">Brand</div>'
    + '<div class="card-ham-brand-name" style="font-family:'+df.family+';color:'+thC+'">'+brand.name+'</div>'
    + '<div class="card-ham-brand-num" style="font-family:'+bf.family+';color:'+(needsDarkText(p)?'rgba(0,0,0,0.5)':'rgba(255,255,255,0.45)')+'">'+(brand.n!=='0'?'District #'+brand.n:'Default')+(brand.city?' · '+brand.city:'')+'</div>'
    + '<div class="card-ham-colors">'
    + '<div><div class="card-ham-swatch" style="background:'+p+';border-color:'+(needsDarkText(p)?'rgba(0,0,0,0.2)':'rgba(255,255,255,0.2)')+'"></div><div class="card-ham-swatch-label" style="color:'+(needsDarkText(p)?'rgba(0,0,0,0.4)':'rgba(255,255,255,0.4)')+'">Primary</div></div>'
    + '<div><div class="card-ham-swatch" style="background:'+s+';border-color:'+(needsDarkText(p)?'rgba(0,0,0,0.2)':'rgba(255,255,255,0.2)')+'"></div><div class="card-ham-swatch-label" style="color:'+(needsDarkText(p)?'rgba(0,0,0,0.4)':'rgba(255,255,255,0.4)')+'">Secondary</div></div>'
    + '</div>'
    + '</div></div>'
    // Banner (hamburger + title only — no logo)
    + '<div class="card-banner" style="background:'+p+'">'
    + '<div class="card-banner-inner">'
    + '<svg class="card-banner-hamburger" onclick="openHamDrawer(\''+hamId+'\',\''+overlayId+'\')" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="'+thC+'" stroke-width="2.5" stroke-linecap="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>'
    + '<div class="card-banner-title" style="font-family:'+df.family+';'+dls+'color:'+thC+'">'+app.banner+'</div>'
    + '</div>'
    + '<div class="card-banner-accent" style="background:'+s+'"></div>'
    + '</div>'
    // App Body
    + '<div class="card-app-body">'+appBody(app.id, df, bf, brand)+'</div>'
    // Footer
    + '<div class="card-footer">'
    + '<div class="card-font-labels">'
    + '<div><span class="tag">APP</span>&nbsp;&nbsp;'+app.name+'</div>'
    + '<div><span class="tag">BRAND</span>&nbsp;&nbsp;'+brand.name+(brand.n!=="0"?' #'+brand.n:'')+'</div>'
    + '<div><span class="tag">DISPLAY</span>&nbsp;&nbsp;'+df.name+'&nbsp;&nbsp;·&nbsp;&nbsp;<span class="tag">BODY</span>&nbsp;&nbsp;'+bf.name+'</div>'
    + '</div>'
    + '<div class="card-actions">'
    + '<button class="btn-star" onclick="toggleStar('+card.id+')" title="Favorite">★</button>'
    + '<button class="btn-dup" onclick="duplicateCard('+card.id+')" title="Duplicate">⧉</button>'
    + '<button class="btn-del" onclick="removeCard('+card.id+')" title="Remove">✕</button>'
    + '</div></div></div>';
}

// ═══════ NAV ITEMS PER APP GROUP ═══════
function getNavItems(app) {
  switch(app.group) {
    case 'Contracts': return ['Contract Management','Audit Entries','My Account','User Management','Data Management'];
    case 'Payments': return ['Payment Dashboard','RFP Form','Audit Entries','My Account','User Management','Data Management'];
    case 'Budget': return ['Budget Monitoring','Audit Entries','My Account','Data Management'];
    case 'Debt': return ['Debt Management','Audit Entries','My Account'];
    case 'Benchmarking': return ['Revenues','Salaries & FTE','ADM Detail','Open Enrollment','My Account'];
    default: return ['Dashboard','My Account'];
  }
}

// ═══════ HAMBURGER DRAWER OPEN/CLOSE ═══════
function openHamDrawer(drawerId, overlayId) {
  const drawer = document.getElementById(drawerId);
  const overlay = document.getElementById(overlayId);
  if (!drawer || !overlay) return;
  overlay.classList.add('open');
  drawer.style.display = 'block';
  drawer.offsetHeight; // force reflow
  drawer.classList.add('open');
}
function closeHamDrawer(drawerId, overlayId) {
  const drawer = document.getElementById(drawerId);
  const overlay = document.getElementById(overlayId);
  if (!drawer || !overlay) return;
  drawer.classList.remove('open');
  overlay.classList.remove('open');
  setTimeout(() => { drawer.style.display = ''; }, 200);
}

// ═══════ STATE & RENDER ═══════
let cards = [], cardIdCounter = 0, showStarredOnly = false;
const STORAGE_KEY = 'bondwood-workbench-state';

function render() {
  const grid = document.getElementById("grid");
  const empty = document.getElementById("emptyState");
  const visible = showStarredOnly ? cards.filter(c => c.starred) : cards;
  const starredCount = cards.filter(c => c.starred).length;
  document.getElementById("cardCount").textContent = cards.length + " card" + (cards.length !== 1 ? "s" : "");
  document.getElementById("btnClear").style.display = cards.length > 1 ? "" : "none";
  const favBtn = document.getElementById("btnFavFilter");
  if (starredCount > 0) {
    favBtn.style.display = "";
    favBtn.className = "btn-fav-filter" + (showStarredOnly ? " active" : "");
    favBtn.innerHTML = "★ " + starredCount + " Fav" + (starredCount !== 1 ? "s" : "") + (showStarredOnly ? " (showing)" : "");
  } else { favBtn.style.display = "none"; if (showStarredOnly) showStarredOnly = false; }
  if (visible.length === 0) {
    grid.innerHTML = "";
    empty.style.display = "";
    empty.textContent = showStarredOnly ? "No favorites yet." : 'Pick an app, brand, and fonts above — then click "+ Add Preview" to start comparing.';
  } else {
    empty.style.display = "none";
    grid.innerHTML = visible.map(buildCardHTML).join("");
    drawDonuts();
  }
  updateSaveUI();
}

function addCard() {
  const appIdx = parseInt(document.getElementById("csApp").dataset.selectedIdx);
  const brandIdx = parseInt(document.getElementById("csBrand").dataset.selectedIdx);
  const displayIdx = parseInt(document.getElementById("csDisplay").dataset.selectedIdx);
  const bodyIdx = parseInt(document.getElementById("csBody").dataset.selectedIdx);
  loadFont(FONTS[displayIdx].import);
  loadFont(FONTS[bodyIdx].import);
  cards.push({ id: cardIdCounter++, appIdx, brandIdx, displayIdx, bodyIdx, starred: false });
  render();
  autoSave();
  window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
}

function removeCard(id) { cards = cards.filter(c => c.id !== id); render(); autoSave(); }
function duplicateCard(id) { const s = cards.find(c => c.id === id); if (s) { cards.push({ ...s, id: cardIdCounter++, starred: false }); render(); autoSave(); } }
function toggleStar(id) { const c = cards.find(c => c.id === id); if (c) { c.starred = !c.starred; render(); autoSave(); } }
function toggleFavFilter() { showStarredOnly = !showStarredOnly; render(); }
function clearAll() { if (confirm("Remove all cards?")) { cards = []; render(); autoSave(); } }

// ═══════ RANDOM CARDS ═══════
function addRandomCards() {
  const rng = (arr) => Math.floor(Math.random() * arr.length);
  // Always use AMSD districts for random
  const amsdIndices = [];
  DISTRICTS.forEach((d, i) => {
    if (i === 0) return;
    if (d.org === 'AMSD') amsdIndices.push(i);
  });
  // Body font must be sans-serif
  const sansBodyIndices = FONTS.map((f, i) => i).filter(i => {
    const fam = FONTS[i].family;
    return fam.includes('sans-serif') || !fam.includes('serif');
  });
  for (let i = 0; i < 12; i++) {
    const appIdx = rng(APPS);
    const brandIdx = amsdIndices[rng(amsdIndices)];
    const displayIdx = rng(FONTS);
    const bodyIdx = sansBodyIndices[rng(sansBodyIndices)];
    loadFont(FONTS[displayIdx].import);
    loadFont(FONTS[bodyIdx].import);
    cards.push({ id: cardIdCounter++, appIdx, brandIdx, displayIdx, bodyIdx, starred: false });
  }
  render();
  autoSave();
  window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
}

// ═══════ LOCALSTORAGE PERSISTENCE ═══════
function getSerializableState() {
  return {
    version: 2,
    theme: document.documentElement.getAttribute('data-theme'),
    cards: cards.map(c => ({
      appIdx: c.appIdx,
      brandIdx: c.brandIdx,
      displayIdx: c.displayIdx,
      bodyIdx: c.bodyIdx,
      starred: c.starred
    }))
  };
}

function saveState() {
  try {
    const state = getSerializableState();
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    const ind = document.getElementById('saveIndicator');
    ind.textContent = '✓ Saved ' + cards.length + ' cards';
    ind.classList.add('flash');
    setTimeout(() => { ind.classList.remove('flash'); ind.textContent = ''; }, 2000);
    updateSaveUI();
  } catch(e) {
    console.error('Save failed:', e);
    alert('Could not save — localStorage may be full or disabled.');
  }
}

function autoSave() {
  // Debounced auto-save
  clearTimeout(autoSave._timer);
  autoSave._timer = setTimeout(() => {
    try {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(getSerializableState()));
      updateSaveUI();
    } catch(e) { /* silent */ }
  }, 500);
}

function loadState() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return false;
    const state = JSON.parse(raw);
    if (!state || !state.cards || !state.cards.length) return false;

    // Confirm if we have existing cards
    if (cards.length > 0 && !confirm('Replace current ' + cards.length + ' card(s) with saved layout (' + state.cards.length + ' cards)?')) return false;

    // Restore theme
    if (state.theme) {
      document.documentElement.setAttribute('data-theme', state.theme);
      document.getElementById('themeLabel').textContent = state.theme === 'dark' ? 'Dark' : 'Light';
    }

    // Restore cards
    cards = [];
    cardIdCounter = 0;
    state.cards.forEach(c => {
      // Validate indices
      if (c.appIdx >= 0 && c.appIdx < APPS.length &&
          c.brandIdx >= 0 && c.brandIdx < DISTRICTS.length &&
          c.displayIdx >= 0 && c.displayIdx < FONTS.length &&
          c.bodyIdx >= 0 && c.bodyIdx < FONTS.length) {
        loadFont(FONTS[c.displayIdx].import);
        loadFont(FONTS[c.bodyIdx].import);
        cards.push({
          id: cardIdCounter++,
          appIdx: c.appIdx,
          brandIdx: c.brandIdx,
          displayIdx: c.displayIdx,
          bodyIdx: c.bodyIdx,
          starred: !!c.starred
        });
      }
    });
    render();
    const ind = document.getElementById('saveIndicator');
    ind.textContent = '✓ Loaded ' + cards.length + ' cards';
    ind.classList.add('flash');
    setTimeout(() => { ind.classList.remove('flash'); ind.textContent = ''; }, 2000);
    return true;
  } catch(e) {
    console.error('Load failed:', e);
    return false;
  }
}

function hasSavedState() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return false;
    const state = JSON.parse(raw);
    return state && state.cards && state.cards.length > 0;
  } catch(e) { return false; }
}

function updateSaveUI() {
  const loadBtn = document.getElementById('btnLoad');
  const saveBtn = document.getElementById('btnSave');
  const has = hasSavedState();
  loadBtn.style.display = has ? '' : 'none';
  saveBtn.classList.toggle('has-save', has && cards.length > 0);
}

// ═══════ DONUT DRAWING ═══════
function drawDonuts() {
  document.querySelectorAll(".donut-canvas").forEach(canvas => {
    const pct = parseInt(canvas.dataset.pct) || 0;
    const pColor = canvas.dataset.p || "#000";
    const ctx = canvas.getContext("2d");
    const w = canvas.width, h = canvas.height, cx = w/2, cy = h/2, r = Math.min(w,h)/2 - 4, lw = 6;
    ctx.clearRect(0,0,w,h);
    ctx.beginPath(); ctx.arc(cx,cy,r,0,Math.PI*2); ctx.strokeStyle = "rgba(128,128,128,0.15)"; ctx.lineWidth = lw; ctx.stroke();
    ctx.beginPath(); ctx.arc(cx,cy,r,-Math.PI/2,-Math.PI/2 + (pct/100)*Math.PI*2); ctx.strokeStyle = pColor; ctx.lineWidth = lw; ctx.lineCap = "round"; ctx.stroke();
    ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text').trim() || "#e8e8e8";
    ctx.font = "bold 10px Inter"; ctx.textAlign = "center"; ctx.textBaseline = "middle";
    ctx.fillText(pct + "%", cx, cy);
  });
}

// ═══════ DRAG & DROP ═══════
let dragId = null;
function onDragStart(e, id) {
  dragId = id;
  e.dataTransfer.effectAllowed = "move";
  // Set a drag image (slight delay so the class applies)
  requestAnimationFrame(() => {
    const el = document.getElementById("card-" + id);
    if (el) el.classList.add("dragging");
  });
}
function onDragOver(e, targetId) {
  e.preventDefault();
  e.dataTransfer.dropEffect = "move";
  // Show position indicator
  if (dragId === null || dragId === targetId) return;
  const card = e.currentTarget.closest('.card');
  if (!card) return;
  const rect = card.getBoundingClientRect();
  const midY = rect.top + rect.height / 2;
  card.classList.remove('drag-over-top', 'drag-over-bottom');
  if (e.clientY < midY) {
    card.classList.add('drag-over-top');
  } else {
    card.classList.add('drag-over-bottom');
  }
}
function onDragEnter(e) { e.preventDefault(); }
function onDragLeave(e) {
  const card = e.currentTarget.closest('.card');
  if (card && !card.contains(e.relatedTarget)) {
    card.classList.remove('drag-over', 'drag-over-top', 'drag-over-bottom');
  }
}
function onDrop(e, targetId) {
  e.preventDefault();
  document.querySelectorAll('.card').forEach(el => el.classList.remove('drag-over','drag-over-top','drag-over-bottom'));
  if (dragId === null || dragId === targetId) return;
  const fromIdx = cards.findIndex(c => c.id === dragId);
  const toIdx = cards.findIndex(c => c.id === targetId);
  if (fromIdx === -1 || toIdx === -1) return;
  const [moved] = cards.splice(fromIdx, 1);
  cards.splice(toIdx, 0, moved);
  render();
  autoSave();
}
function onDragEnd() {
  dragId = null;
  document.querySelectorAll(".card").forEach(el => el.classList.remove("dragging","drag-over","drag-over-top","drag-over-bottom"));
}

// ═══════ INIT ═══════
function init() {
  loadFont(FONTS[fi("Cal Sans")].import);
  loadFont(FONTS[fi("Google Sans Flex")].import);
  buildAppSelect("csApp");
  buildBrandSelect("csBrand");
  buildFontSelect("csDisplay", fi("Cal Sans") >= 0 ? fi("Cal Sans") : 0);
  buildFontSelect("csBody", fi("Google Sans Flex") >= 0 ? fi("Google Sans Flex") : 0);

  // Try to auto-load saved state on startup
  const autoLoaded = loadStateQuiet();
  if (!autoLoaded) render();
}

function loadStateQuiet() {
  // Silent load on startup — no confirm prompt
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return false;
    const state = JSON.parse(raw);
    if (!state || !state.cards || !state.cards.length) return false;

    if (state.theme) {
      document.documentElement.setAttribute('data-theme', state.theme);
      document.getElementById('themeLabel').textContent = state.theme === 'dark' ? 'Dark' : 'Light';
    }

    cards = [];
    cardIdCounter = 0;
    state.cards.forEach(c => {
      if (c.appIdx >= 0 && c.appIdx < APPS.length &&
          c.brandIdx >= 0 && c.brandIdx < DISTRICTS.length &&
          c.displayIdx >= 0 && c.displayIdx < FONTS.length &&
          c.bodyIdx >= 0 && c.bodyIdx < FONTS.length) {
        loadFont(FONTS[c.displayIdx].import);
        loadFont(FONTS[c.bodyIdx].import);
        cards.push({
          id: cardIdCounter++,
          appIdx: c.appIdx,
          brandIdx: c.brandIdx,
          displayIdx: c.displayIdx,
          bodyIdx: c.bodyIdx,
          starred: !!c.starred
        });
      }
    });
    render();
    return cards.length > 0;
  } catch(e) { return false; }
}

document.addEventListener("DOMContentLoaded", init);
</script></body></html>
